<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>COMP/STAT 112: Introduction to Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/01-RStudio_Intro.html">Src</a></li><li class="breadcrumb-item"><a href="../src/07-Six_Main_Verbs.html">(PART) Data Wrangling</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">COMP/STAT 112: Introduction to Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Src</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01-RStudio_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">P1: Intro to R, RStudio, and R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02-Intro_Data_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03-Effective_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effective Visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/04-Bivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">options(htmltools.dir.version = FALSE)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/05-Multivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate Visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/07-Six_Main_Verbs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">(PART) Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/08-Reshaping_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reshaping Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/09-Join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Joining Two Data Frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/10-Factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables as Factors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/11-Mini_Project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mini-Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/12-Data_Import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Acquisition &amp; Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/13-EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/14-Regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular Expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/15-Data_Scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Additional Topics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/16-API.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Public Web APIs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/17-SQL.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/18-Text_Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/19-Adv_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/21-Prez_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation Tools</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-data-wrangling" id="toc-part-data-wrangling" class="nav-link active" data-scroll-target="#part-data-wrangling">(PART) Data Wrangling</a></li>
  <li><a href="#six-main-verbs" id="toc-six-main-verbs" class="nav-link" data-scroll-target="#six-main-verbs">Six Main Verbs</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals">Learning Goals</a></li>
  <li><a href="#data-wrangling-introduction" id="toc-data-wrangling-introduction" class="nav-link" data-scroll-target="#data-wrangling-introduction">Data Wrangling Introduction</a>
  <ul class="collapse">
  <li><a href="#example-us-births" id="toc-example-us-births" class="nav-link" data-scroll-target="#example-us-births">Example: US Births</a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy Data</a></li>
  <li><a href="#data-verbs" id="toc-data-verbs" class="nav-link" data-scroll-target="#data-verbs">Data Verbs</a></li>
  <li><a href="#piping" id="toc-piping" class="nav-link" data-scroll-target="#piping">Piping</a></li>
  <li><a href="#manipulating-dates" id="toc-manipulating-dates" class="nav-link" data-scroll-target="#manipulating-dates">Manipulating Dates</a></li>
  </ul></li>
  <li><a href="#practice-part-1-baby-names" id="toc-practice-part-1-baby-names" class="nav-link" data-scroll-target="#practice-part-1-baby-names">Practice Part 1: Baby Names</a></li>
  <li><a href="#practice-part-2-us-births" id="toc-practice-part-2-us-births" class="nav-link" data-scroll-target="#practice-part-2-us-births">Practice Part 2: US Births</a>
  <ul class="collapse">
  <li><a href="#seasonality" id="toc-seasonality" class="nav-link" data-scroll-target="#seasonality">Seasonality</a></li>
  <li><a href="#day-of-the-week" id="toc-day-of-the-week" class="nav-link" data-scroll-target="#day-of-the-week">Day of the Week</a></li>
  <li><a href="#holidays" id="toc-holidays" class="nav-link" data-scroll-target="#holidays">Holidays</a></li>
  <li><a href="#geography" id="toc-geography" class="nav-link" data-scroll-target="#geography">Geography</a></li>
  <li><a href="#superstition" id="toc-superstition" class="nav-link" data-scroll-target="#superstition">Superstition</a></li>
  </ul></li>
  <li><a href="#appendix-r-functions" id="toc-appendix-r-functions" class="nav-link" data-scroll-target="#appendix-r-functions">Appendix: R Functions</a>
  <ul class="collapse">
  <li><a href="#six-main-verbs-1" id="toc-six-main-verbs-1" class="nav-link" data-scroll-target="#six-main-verbs-1">Six Main Verbs</a></li>
  <li><a href="#logicalboolean-operators" id="toc-logicalboolean-operators" class="nav-link" data-scroll-target="#logicalboolean-operators">Logical/Boolean Operators</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="part-data-wrangling" class="level1 unnumbered">
<h1 class="unnumbered">(PART) Data Wrangling</h1>
</section>
<section id="six-main-verbs" class="level1">
<h1>Six Main Verbs</h1>
<section id="learning-goals" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learning-goals">Learning Goals</h2>
<ul>
<li>Understand and be able to use the following verbs appropriate: <code>select</code>, <code>mutate</code>, <code>filter</code>, <code>arrange</code>, <code>summarize</code>, <code>group_by</code></li>
<li>Develop an understanding what code will do conceptually without running it</li>
<li>Develop working knowledge of working with dates and <code>lubridate</code> functions</li>
</ul>
<p>You can download a template .Rmd of this activity <a href="template_rmd/07-Six_Main_Verbs_Assign.Rmd">here</a>. Add it to a folder called <code>Assignment_05</code> in your <code>COMP_STAT_112</code> folder.</p>
</section>
<section id="data-wrangling-introduction" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="data-wrangling-introduction">Data Wrangling Introduction</h2>
<section id="example-us-births" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-us-births">Example: US Births</h3>
<p>The number of daily births in the US varies over the year and from day to day. What’s surprising to many people is that the variation from one day to the next can be huge: some days have only about 80% as many births as others. Why? In this activity we’ll use basic data wrangling skills to understand some drivers of daily births.</p>
<p>The data table <code>Birthdays</code> in the <code>mosaicData</code> package gives the number of births recorded on each day of the year in each state from 1969 to 1988.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>A subset of the initial birthday data.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: left;">date</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">births</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AK</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">174</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AR</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">78</td>
</tr>
<tr class="even">
<td style="text-align: left;">AZ</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">824</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tidy-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tidy-data">Tidy Data</h3>
<p>Additional reading:</p>
<ul>
<li><a href="https://www.jstatsoft.org/article/view/v059i10">Wickham, Tidy Data</a></li>
<li><a href="http://r4ds.had.co.nz/tidy-data.html">Wickham and Grolemund, Tidy Data</a></li>
<li><a href="https://mdsr-book.github.io/mdsr2e/ch-dataII.html#tidy-data">Baumer, Kaplan, and Horton, Tidy Data</a></li>
</ul>
<p>There are different ways to store and represent the same data. In order to be consistent and to also take advantage of the vectorized nature of <code>R</code>, the <code>tidyverse</code> packages we’ll use provide a set of three interrelated rules/conventions for a dataset to be <code>tidy</code>:</p>
<ol type="1">
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ol>
<p>One of the first things we’ll often do when acquiring new data is to “tidy it” into this form. For now, we can already start thinking of a data frame (tibble) as a table whose rows are the individual cases and whose columns are the variables on which we have information for each individual case. The first figure from the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf"><code>tidyr</code> cheat sheet</a> summarizes this principle.</p>
</section>
<section id="data-verbs" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="data-verbs">Data Verbs</h3>
<p>Additional reading:</p>
<ul>
<li><a href="http://r4ds.had.co.nz/transform.html">Wickham and Grolemund, Data Transformation</a></li>
<li><a href="https://mdsr-book.github.io/mdsr2e/ch-dataI.html">Baumer, Kaplan, and Horton, A Grammar for Data Wrangling</a></li>
</ul>
<p>There are six main data transformation verbs in the <code>dplyr</code> library. Each verb takes an input data frame along with additional arguments specifying the action, and returns a new data frame. We’ll examine them in three pairs.</p>
<section id="verbs-that-change-the-variables-columns-but-not-the-cases-rows" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="verbs-that-change-the-variables-columns-but-not-the-cases-rows">Verbs that change the variables (columns) but not the cases (rows)</h4>
<p>The first two verbs change which variables (columns) are included in the data frame, but preserve the same set of cases (rows).</p>
<ul>
<li><p><strong><code>select()</code></strong> chooses which columns to keep, or put another way, deletes those colummns that are not selected. To specify the columns, we can either list them out, or use functions like <code>starts_with()</code>, <code>ends_with()</code>, or <code>contains()</code> to specify the titles of the variables we wish to keep.</p></li>
<li><p><strong><code>mutate()</code></strong> adds one or more columns to the data frame. Each column is a function of the other columns that is applied on a row by row basis. For example, we can use arithmetic operations like adding two other variables or logical operations like checking if two columns are equal, or equal to a target number.</p></li>
</ul>
<div class="cell" name="select and mutate">
<pre class="example cell-code"><code>Consider the `Birthdays` data</code></pre>
</div>
<ol type="a">
<li>Add two new variables to the <code>Birthdays</code> data: one that has only the last two digits of the year, and one that states whether there were more than 100 births in the given state on the given date.<br>
</li>
<li>Then form a new table that only has three columns: the state and your two new columns.<br>
</li>
<li>What does the following operation return (describe the output): <code>select(Birthdays, ends_with("te"))</code>?</li>
</ol>
<details>
<summary>
Solution
</summary>
<p>The commands for the first two parts are</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>BirthdaysExtra <span class="ot">&lt;-</span> <span class="fu">mutate</span>(Birthdays,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_short =</span> year <span class="sc">-</span> <span class="dv">1900</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">busy_birthday =</span> (births <span class="sc">&gt;</span> <span class="dv">100</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>BirthdaysExtraTable <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  BirthdaysExtra, state,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  year_short, busy_birthday</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(Birthdays, <span class="fu">ends_with</span>(<span class="st">"te"</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state       date
1    AK 1969-01-01
2    AL 1969-01-01
3    AR 1969-01-01
4    AZ 1969-01-01
5    CA 1969-01-01
6    CO 1969-01-01</code></pre>
</div>
</div>
The operation in (c) provides a data set with only the two columns <code>state</code> and <code>date</code> because they end in ‘te’.
</details>
<p><br>
</p>
</section>
<section id="verbs-that-change-the-cases-rows-but-not-the-variables-columns" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="verbs-that-change-the-cases-rows-but-not-the-variables-columns">Verbs that change the cases (rows) but not the variables (columns)</h4>
<p>The next two verbs change which cases (rows) are included in the data frame, but preserve the same set of variables (columns).</p>
<ul>
<li><p><strong><code>filter()</code></strong> deletes some of the rows by specifying which rows to keep.</p></li>
<li><p><strong><code>arrange()</code></strong> reorders the rows according to a specified criteria. To sort in reverse order based on the variable <code>x</code>, use <code>arrange(desc(x))</code>.</p></li>
</ul>
<div class="cell" name="filter and arrange">
<pre class="example cell-code"><code>Create a table with only births in Massachusetts in 1979, and sort the days from those with the most births to those with the fewest.
</code></pre>
</div>
<details>
<summary>
Solution
</summary>
<p>We want to <code>filter</code> and then <code>arrange</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>MABirths1979 <span class="ot">&lt;-</span> <span class="fu">filter</span>(Birthdays, state <span class="sc">==</span> <span class="st">"MA"</span>, year <span class="sc">==</span> <span class="dv">1979</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>MABirths1979Sorted <span class="ot">&lt;-</span> <span class="fu">arrange</span>(MABirths1979, <span class="fu">desc</span>(births))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Birthdays in Massachusetts in 1979, sorted from those dates with the most births to those dates with the fewest births.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: left;">date</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">births</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MA</td>
<td style="text-align: left;">1979-09-28</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">262</td>
</tr>
<tr class="even">
<td style="text-align: left;">MA</td>
<td style="text-align: left;">1979-09-11</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">252</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MA</td>
<td style="text-align: left;">1979-12-28</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">249</td>
</tr>
<tr class="even">
<td style="text-align: left;">MA</td>
<td style="text-align: left;">1979-09-26</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">246</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MA</td>
<td style="text-align: left;">1979-07-24</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">245</td>
</tr>
<tr class="even">
<td style="text-align: left;">MA</td>
<td style="text-align: left;">1979-04-27</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">243</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<p><br>
</p>
<p>When filtering, we often use logical comparison operators like <code>==</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code> (greater than or equal to), <code>&lt;=</code> (less than or equal to), and <code>%in%</code>, which compares the value to a list of entries.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> For example, if we want all births in AK, CA, and MA, we can write</p>
<pre><code>filter(Birthdays, state %in% c("AK","CA","MA"))</code></pre>
<p>The <code>c()</code> here is for concatenate, which is how we form vectors in <code>R</code>.</p>
</section>
<section id="grouped-summaries" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="grouped-summaries">Grouped summaries</h4>
<ul>
<li><strong><code>summarize()</code></strong> (or equivalently <strong><code>summarise()</code></strong>) takes an entire data frame as input and outputs a single row with one or more summary statistics, such as <code>mean()</code>, <code>sum()</code>, <code>sd()</code>, <code>n_distinct()</code>, or <code>n()</code> (which just counts the number of entries/rows).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(Birthdays,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_births =</span> <span class="fu">sum</span>(births),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">average_births =</span> <span class="fu">mean</span>(births),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nstates =</span> <span class="fu">n_distinct</span>(state), <span class="at">ncases =</span> <span class="fu">n</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  total_births average_births nstates ncases
1     70486538       189.0409      51 372864</code></pre>
</div>
</div>
<p>So <code>summarize</code> changes both the cases and the variables. Alone, <code>summarize</code> is not all that useful, because we can also access individual variables directly with the dollar sign. For example, to find the total and average births, we can write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(Birthdays<span class="sc">$</span>births)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70486538</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Birthdays<span class="sc">$</span>births)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 189.0409</code></pre>
</div>
</div>
<p>Rather, we will mostly use it to create <strong>grouped summaries</strong>, which brings us to the last of the six main data verbs.</p>
<ul>
<li><strong><code>group_by()</code></strong> groups the cases of a data frame by a specified set of variables. The size of the stored data frame does not actually change (neither the cases nor the variables change), but then other functions can be applied to the specified groups instead of the entire data set. We’ll often use <code>group_by</code> in conjunction with <code>summarize</code> to get a grouped summary.</li>
</ul>
<div class="cell" name="grouped summary">
<pre class="example cell-code"><code>Consider the `Birthdays` data again.</code></pre>
</div>
<ol type="a">
<li>Find the average number of daily births in each year (average across states).</li>
<li>Find the average number of daily births in each year, by state.</li>
</ol>
<details>
<summary>
Solution
</summary>
<p>We have to first group by the desired grouping and then perform a <code>summarize</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>BirthdaysYear <span class="ot">&lt;-</span> <span class="fu">group_by</span>(Birthdays, year)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(BirthdaysYear, <span class="at">average =</span> <span class="fu">mean</span>(births))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
    year average
   &lt;int&gt;   &lt;dbl&gt;
 1  1969    192.
 2  1970    200.
 3  1971    191.
 4  1972    175.
 5  1973    169.
 6  1974    170.
 7  1975    169.
 8  1976    170.
 9  1977    179.
10  1978    179.
11  1979    188.
12  1980    194.
13  1981    195.
14  1982    198.
15  1983    196.
16  1984    197.
17  1985    202.
18  1986    202.
19  1987    205.
20  1988    210.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>BirthdaysYearState <span class="ot">&lt;-</span> <span class="fu">group_by</span>(Birthdays, year, state)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(BirthdaysYearState, <span class="at">average =</span> <span class="fu">mean</span>(births))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,020 × 3
# Groups:   year [20]
    year state average
   &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
 1  1969 AK       18.6
 2  1969 AL      174. 
 3  1969 AR       91.3
 4  1969 AZ       93.3
 5  1969 CA      954. 
 6  1969 CO      110. 
 7  1969 CT      134. 
 8  1969 DC       75.3
 9  1969 DE       27.6
10  1969 FL      292. 
# ℹ 1,010 more rows</code></pre>
</div>
</div>
</details>
<p><br>
</p>
</section>
</section>
<section id="piping" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="piping">Piping</h3>
<p>Additional reading:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/transform.html#combining-multiple-operations-with-the-pipe">Wickham and Grolemund, Combining Multiple Operations with the Pipe</a></li>
<li><a href="http://r4ds.had.co.nz/pipes.html">Wickham and Grolemund, Pipes</a></li>
</ul>
<p>Pipes offer an efficient way to execute multiple operations at once. Here is a more efficient way to redo Example 7.2 with <strong>the pipe</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>QuickMABirths1979 <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  Birthdays <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"MA"</span>, year <span class="sc">==</span> <span class="dv">1979</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(births))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the pipe notation, <code>x %&gt;% f(y)</code> becomes <code>f(x,y)</code>, where in the first line here, <code>x</code> is <code>Birthdays</code>, the function <code>f</code> is <code>filter</code>, and <code>y</code> is <code>state == "MA", year == 1979</code>. The really nice thing about piping is that you can chain together a bunch of different operations without having to save the intermediate results. This is what we have done above by chaining together a <code>filter</code> followed by an <code>arrange</code>.</p>
</section>
<section id="manipulating-dates" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="manipulating-dates">Manipulating Dates</h3>
<p>Additional reading:</p>
<ul>
<li><a href="http://r4ds.had.co.nz/dates-and-times.html">Wickham and Grolemund, Date and Times with <code>lubridate</code></a></li>
</ul>
<p>The <code>date</code> variable in <code>Birthdays</code> prints out in the conventional, human-readable way. But it is actually in a format (called <code>POSIX</code> date format) that automatically respects the order of time. The <code>lubridate</code> package contains helpful functions that will extract various information about any date. Here are some you might find useful:</p>
<ul>
<li><code>year()</code></li>
<li><code>month()</code></li>
<li><code>week()</code></li>
<li><code>yday()</code> — gives the day of the year as a number 1-366. This is often called the “Julian day.”</li>
<li><code>mday()</code> — gives the day of the month as a number 1-31</li>
<li><code>wday()</code> — gives the weekday (e.g.&nbsp;Monday, Tuesday, …). Use the optional argument <code>label = TRUE</code> to have the weekday spelled out rather than given as a number 1-7.</li>
</ul>
<p>Using these <code>lubridate</code> functions, you can easily look at the data in more detail. For example, we can add columns to the date table for month and day of the week:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Birthdays <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  Birthdays <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is what the data table looks like with our new columns:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>A subset of the birthday data with additional variables.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: left;">date</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">births</th>
<th style="text-align: left;">month</th>
<th style="text-align: left;">weekday</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AK</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">Jan</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">174</td>
<td style="text-align: left;">Jan</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AR</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">78</td>
<td style="text-align: left;">Jan</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="even">
<td style="text-align: left;">AZ</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">84</td>
<td style="text-align: left;">Jan</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">824</td>
<td style="text-align: left;">Jan</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: left;">1969-01-01</td>
<td style="text-align: right;">1969</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">Jan</td>
<td style="text-align: left;">Wed</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<pre class="example cell-code"><code>Make a table showing the five states with the most births between September 9, 1979 and September 11, 1979, inclusive. Arrange the table in descending order of births.</code></pre>
</div>
<details>
<summary>
Solution
</summary>
<p>The plan of attack is to first filter the dates, then group by state, then use a <code>summarize</code> to add up totals for each state, and finally arrange them in descending order to find the top 5.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>SepTable <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  Birthdays <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">ymd</span>(<span class="st">"1979-09-09"</span>), date <span class="sc">&lt;=</span> <span class="fu">ymd</span>(<span class="st">"1979-09-11"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(births)) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  SepTable[, ],</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"States with the</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">  most births between September 9, 1979</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">  and September 11, 1979, inclusive."</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>States with the most births between September 9, 1979 and September 11, 1979, inclusive.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: right;">3246</td>
</tr>
<tr class="even">
<td style="text-align: left;">TX</td>
<td style="text-align: right;">2347</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NY</td>
<td style="text-align: right;">1943</td>
</tr>
<tr class="even">
<td style="text-align: left;">IL</td>
<td style="text-align: right;">1673</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OH</td>
<td style="text-align: right;">1408</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<p><br>
</p>
</section>
</section>
<section id="practice-part-1-baby-names" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="practice-part-1-baby-names">Practice Part 1: Baby Names</h2>
<p>We are going to practice the six data verbs on the <code>babynames</code> dataset:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>A subset of the babynames data, which runs from 1880-2015 and is provided by the US Social Security Administration.</caption>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">sex</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">prop</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Mary</td>
<td style="text-align: right;">7065</td>
<td style="text-align: right;">0.0723836</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Anna</td>
<td style="text-align: right;">2604</td>
<td style="text-align: right;">0.0266790</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Emma</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">0.0205215</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Elizabeth</td>
<td style="text-align: right;">1939</td>
<td style="text-align: right;">0.0198658</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Minnie</td>
<td style="text-align: right;">1746</td>
<td style="text-align: right;">0.0178884</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Margaret</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">0.0161672</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Add a new boolean (true or false) variable called `has2000` that indicates whether there were more than 2000 babies of that sex assigned at birth with that name in each year. Display the first six rows of your new table.
</code></pre>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Find the number of total babies per year, sorted by most babies to least babies.
</code></pre>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Find the twelve most popular names overall (i.e., totaled over all year and sexes), ordered by popularity.
</code></pre>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Find the most popular names for males, over all years and ordered by popularity.
</code></pre>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>For each line of code below, describe the output passed to the next function. Write your answers as comments in the code. Try to see if you can describe the output without running the code, an important skill to develop! </code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( year <span class="sc">&gt;=</span> <span class="dv">1900</span>, year <span class="sc">&lt;</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YearCat =</span> <span class="fu">cut</span>(year, <span class="fu">c</span>(<span class="dv">1900</span>,<span class="dv">1950</span>,<span class="dv">2000</span>), <span class="at">right =</span> <span class="cn">FALSE</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">'Early 1900'</span>,<span class="st">'Late 1900'</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex,YearCat,name) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex,YearCat, n) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex,YearCat) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">dense_rank</span>(<span class="sc">-</span>n))  <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex,rank) <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Calculate the number of babies born each decade, and arrange them in descending order. Calculating the decade may be the trickiest part of this question!   
  
</code></pre>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Calculate the most popular name for each year. Print out the answer for the years 2006-2015. This is tricky, but try Googling for hints.
</code></pre>
</div>
</section>
<section id="practice-part-2-us-births" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="practice-part-2-us-births">Practice Part 2: US Births</h2>
<p>Now we are ready to return to the <code>Birthdays</code> data set to investigate some drivers of daily births in the US.</p>
<section id="seasonality" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="seasonality">Seasonality</h3>
<p>For this activity, we need to work with data aggregated across the states.</p>
<div class="cell" name="Total Across States">
<pre class="exercise cell-code"><code>Create a new data table, `DailyBirths`, that adds up all the births for each day across all the states.  Plot out daily births vs date.
</code></pre>
</div>
<p><strong><em>For all of the remaining exercises, start with your <code>DailyBirths</code> data frame.</em></strong></p>
<div class="cell" name="Examine Seasonality">
<pre class="exercise cell-code"><code>
To examine seasonality in birth rates, look at the daily number of births using `DailyBirths` (don't aggregate) by

a. week of the year (1-53)
b. month of the year (January to December)
c. Julian day (1-366)

When are the most babies born? The fewest?
</code></pre>
</div>
</section>
<section id="day-of-the-week" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="day-of-the-week">Day of the Week</h3>
<div class="cell" name="Examine Patterns within the Week">
<pre class="exercise cell-code"><code>To examine patterns within the week, make a box plot showing the daily number of births by day of the week (use `DailyBirths`). Interpret your results.
</code></pre>
</div>
</section>
<section id="holidays" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="holidays">Holidays</h3>
<div class="cell" name="Two Year Sample">
<pre class="exercise cell-code"><code>Pick a two-year span of the `DailyBirths` that falls in the 1980s, say, 1980/1981.  Extract out the data just in this interval, calling it `MyTwoYears`.  (Hint: `filter()`, `year()`).  Plot out the births in this two-year span day by day. Color each date according to its day of the week.  Make sure to choose your font size, line widths, and color scheme to make your figure legible. Explain the pattern that you see.
</code></pre>
</div>
<p>The plot you generate for Exercise @ref(exr:two-year) should be generally consistent with the weekend effect and seasonal patterns we have already seen; however, a few days each year stand out as exceptions. We are going to examine the hypothesis that these are holidays. You can find a data set listing US federal holidays <a href="data/US-Holidays.csv">here</a>. Read it in as follows:<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: 'data/US-Holidays.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/alhashimphd/mac-comp112website-f24/src').</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Holidays <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://bcheggeseth.github.io/112_fall_2022/data/US-Holidays.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.POSIXct</span>(lubridate<span class="sc">::</span><span class="fu">dmy</span>(date)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" name="Holidays">
<pre class="exercise cell-code"><code>Now let's update the plot from Exercise \@ref(exr:two-year) to include the holidays.   

a. Add a variable to `MyTwoYears` called `is_holiday`. It should be `TRUE` when the day is a holiday, and `FALSE` otherwise. One way to do this is with the transformation verb `%in%`, for instance, `is_holiday = date %in% Holidays$date`.   
b. Add a `geom_point` layer to your plot that sets the color of the points based on the day of the week and the shape of the points based on whether or not the day is a holiday.   
c. Finally, some holidays seem to have more of an effect than others. It would be helpful to label them. Use `geom_text` with the holiday data to add labels to each of the holidays. Hints: 1. Start by making a new data table called `MyHolidays` that just contains the holidays in your selected two year window. 2. Start your geometry line with `geom_text(data=MyHolidays)`. 3. You'll have to make up a y-coordinate for each label.  4. You can set the orientation of each label with the `angle` argument; e.g., `geom_text(data=MyHolidays, angle=40, ...)`.
</code></pre>
</div>
</section>
<section id="geography" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="geography">Geography</h3>
<p>In any way you choose, explore the effect of geography on birth patterns using the original <code>Birthdays</code> data. For example, do parents in Minnesota have fewer winter babies than in other states? Which states have the largest increases or decreases in their portion of US births over time? Is the weekend effect less strong for states with a higher percentage of their populations living in rural areas?</p>
<p>If you have extra time or want some extra practice, pick any issue (not all of these) that interests you, explore it, and create a graphic to illustrate your findings.</p>
</section>
<section id="superstition" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="superstition">Superstition</h3>
<p>This <a href="https://fivethirtyeight.com/features/some-people-are-too-superstitious-to-have-a-baby-on-friday-the-13th/">article</a> from FiveThirtyEight demonstrates that fewer babies are born on the 13th of each month, and the effect is even stronger when the 13th falls on a Friday. If you have extra time or want some extra practice, you can try to recreate the first graphic in the article.</p>
</section>
</section>
<section id="appendix-r-functions" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="appendix-r-functions">Appendix: R Functions</h2>
<section id="six-main-verbs-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="six-main-verbs-1">Six Main Verbs</h3>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 39%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Function/Operator</th>
<th style="text-align: center;">Action</th>
<th style="text-align: right;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>select()</code></td>
<td style="text-align: center;">Provides a subset of variables</td>
<td style="text-align: right;"><code>select(Birthdays, state, date, year, births)</code></td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td style="text-align: center;">Creates a new variable</td>
<td style="text-align: right;"><code>mutate(Birthdays, year_short = year - 1900)</code></td>
</tr>
<tr class="odd">
<td><code>filter()</code></td>
<td style="text-align: center;">Provides a subset of rows</td>
<td style="text-align: right;"><code>filter(Birthdays, state %in% c("AK","CA","MA"))</code></td>
</tr>
<tr class="even">
<td><code>arrange()</code></td>
<td style="text-align: center;">Sorts the rows of a dataset</td>
<td style="text-align: right;"><code>arrange(Birthdays, desc(births))</code></td>
</tr>
<tr class="odd">
<td><code>summarize()</code></td>
<td style="text-align: center;">Collapses rows into summaries of variables across rows</td>
<td style="text-align: right;"><code>summarize(Birthdays,total_births = sum(births), average_births = mean(births), nstates = n_distinct(state), ncases = n())</code></td>
</tr>
<tr class="even">
<td><code>group_by()</code></td>
<td style="text-align: center;">Collapses rows into summaries of variables across rows</td>
<td style="text-align: right;"><code>group_by(Birthdays, year, state) %&gt;% summarize(average = mean(births))</code></td>
</tr>
</tbody>
</table>
</section>
<section id="logicalboolean-operators" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="logicalboolean-operators">Logical/Boolean Operators</h3>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 39%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Function/Operator</th>
<th style="text-align: center;">Action</th>
<th style="text-align: right;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>==</code></td>
<td style="text-align: center;">Checks whether two items are equal</td>
<td style="text-align: right;"><code>year == 2000</code></td>
</tr>
<tr class="even">
<td><code>&gt;</code></td>
<td style="text-align: center;">Checks whether left is greater than the right</td>
<td style="text-align: right;"><code>year &gt; 2000</code></td>
</tr>
<tr class="odd">
<td><code>&lt;</code></td>
<td style="text-align: center;">Checks whether left is less than the right</td>
<td style="text-align: right;"><code>year &lt; 2000</code></td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td style="text-align: center;">Checks whether left is greater than or equal to right</td>
<td style="text-align: right;"><code>year &gt;= 2000</code></td>
</tr>
<tr class="odd">
<td><code>&lt;=</code></td>
<td style="text-align: center;">Checks whether left is less than or equal to right</td>
<td style="text-align: right;"><code>year &lt;= 2000</code></td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td style="text-align: center;">Checks whether left is not equal to right</td>
<td style="text-align: right;"><code>year != 2000</code></td>
</tr>
<tr class="odd">
<td><code>%in%</code></td>
<td style="text-align: center;">Checks whether left is in vector on right</td>
<td style="text-align: right;"><code>state %in% c("AK","CA","MA")</code></td>
</tr>
</tbody>
</table>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The <code>fivethirtyeight</code> package has more recent data.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><strong>Important note about <code>=</code> vs.&nbsp;<code>==</code></strong>: A single <code>=</code> is an assignment operator that assigns the value after the equal sign to the variable before the equal sign. We saw an example of this above with <code>year_short = year - 1900</code>. In order to compare whether two values are the same, we need to use the double equal <code>==</code> as in <code>year == 1979</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The <code>label = TRUE</code> argument tells <code>month</code> to return a string abbreviation for the month instead of the month’s number.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The verbs <code>head(n = 5)</code>, <code>tail(n = 3)</code> are often used just after an <code>arrange</code> to keep, e.g., only the first 5 entries or last 3 entries, where <code>n</code> specifies the number of entries to keep.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The point of the <code>lubridate::dmy()</code> function is to convert the character-string date stored in the CSV to a POSIX date-number.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>