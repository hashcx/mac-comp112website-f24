<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>COMP/STAT 112: Introduction to Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/01-RStudio_Intro.html">Src</a></li><li class="breadcrumb-item"><a href="../src/08-Reshaping_Data.html">Reshaping Data</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">COMP/STAT 112: Introduction to Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Src</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01-RStudio_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">P1: Intro to R, RStudio, and R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02-Intro_Data_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03-Effective_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effective Visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/04-Bivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">options(htmltools.dir.version = FALSE)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/05-Multivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate Visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/07-Six_Main_Verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/08-Reshaping_Data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Reshaping Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/09-Join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Joining Two Data Frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/10-Factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables as Factors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/11-Mini_Project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mini-Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/12-Data_Import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Acquisition &amp; Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/13-EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/14-Regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular Expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/15-Data_Scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Additional Topics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/16-API.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Public Web APIs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/17-SQL.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/18-Text_Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/19-Adv_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/21-Prez_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation Tools</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#reshaping-data" id="toc-reshaping-data" class="nav-link active" data-scroll-target="#reshaping-data">Reshaping Data</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals">Learning Goals</a></li>
  <li><a href="#wide-and-long-data-formats" id="toc-wide-and-long-data-formats" class="nav-link" data-scroll-target="#wide-and-long-data-formats">Wide and Long Data Formats</a>
  <ul class="collapse">
  <li><a href="#wider" id="toc-wider" class="nav-link" data-scroll-target="#wider">Wider</a></li>
  <li><a href="#longer" id="toc-longer" class="nav-link" data-scroll-target="#longer">Longer</a></li>
  </ul></li>
  <li><a href="#example-the-daily-show-guests" id="toc-example-the-daily-show-guests" class="nav-link" data-scroll-target="#example-the-daily-show-guests">Example: The Daily Show Guests</a>
  <ul class="collapse">
  <li><a href="#practice-popular-guests" id="toc-practice-popular-guests" class="nav-link" data-scroll-target="#practice-popular-guests">Practice: Popular guests</a></li>
  <li><a href="#practice-recreating-a-graphic" id="toc-practice-recreating-a-graphic" class="nav-link" data-scroll-target="#practice-recreating-a-graphic">Practice: Recreating a graphic</a></li>
  </ul></li>
  <li><a href="#more-practice-pivoting-longer" id="toc-more-practice-pivoting-longer" class="nav-link" data-scroll-target="#more-practice-pivoting-longer">More Practice: Pivoting Longer</a></li>
  <li><a href="#appendix-r-functions" id="toc-appendix-r-functions" class="nav-link" data-scroll-target="#appendix-r-functions">Appendix: R Functions</a>
  <ul class="collapse">
  <li><a href="#reshaping-functions" id="toc-reshaping-functions" class="nav-link" data-scroll-target="#reshaping-functions">Reshaping Functions</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="reshaping-data" class="level1">
<h1>Reshaping Data</h1>
<section id="learning-goals" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learning-goals">Learning Goals</h2>
<ul>
<li>Understand the difference between wide and long data format and distinguish the case (unit of observation) for a given data set</li>
<li>Develop comfort in using <code>pivot_wider</code> and <code>pivot_longer</code> in the <code>tidyr</code> package</li>
</ul>
<p>You can download a template .Rmd of this activity <a href="template_rmd/08-Reshaping_Data_Assign.Rmd">here</a>. Put the file in the existing folder <code>Assignment_06</code> in your <code>COMP_STAT_112</code> folder.</p>
</section>
<section id="wide-and-long-data-formats" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="wide-and-long-data-formats">Wide and Long Data Formats</h2>
<p>Additional reading:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/tidy-data.html#pivoting">Wickham and Grolemund on pivoting</a>, or</li>
<li><a href="https://mdsr-book.github.io/mdsr2e/ch-dataII.html#reshaping-data">Baumer, Kaplan, and Horton on reshaping data</a></li>
</ul>
<p>As we are transforming data, it is important to keep in mind what constitutes each case (row) of the data. For example, in the initial <code>babynames</code> data below, each case is a single name-sex-year combination. So if we have the same name and sex assigned at birth but a different year, that would be a different case.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Each case is one name-sex-year combination.</caption>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">sex</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">prop</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Mary</td>
<td style="text-align: right;">7065</td>
<td style="text-align: right;">0.0723836</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Anna</td>
<td style="text-align: right;">2604</td>
<td style="text-align: right;">0.0266790</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Emma</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">0.0205215</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Elizabeth</td>
<td style="text-align: right;">1939</td>
<td style="text-align: right;">0.0198658</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Minnie</td>
<td style="text-align: right;">1746</td>
<td style="text-align: right;">0.0178884</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Margaret</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">0.0161672</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>It is often necessary to rearrange your data in order to create visualizations, run statistical analysis, etc. We have already seen some ways to rearrange the data to change the unit of observation (also known as the case). For example, what is the case after performing the following command?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>babynamesTotal <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, sex) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each case now represents one name-sex combination:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Long format where each case is one name-sex combination.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Aaban</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">107</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aabha</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aabid</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aabir</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aabriella</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aada</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In this activity, we are going to learn two new operations to reshape and reorganize the data: <code>pivot_wider()</code> and <code>pivot_longer()</code>.</p>
<section id="wider" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="wider">Wider</h3>
<div class="cell">
<pre class="example cell-code"><code>We want to find the common names that are the most gender neutral (used roughly equally for males and females). How should we rearrange the data? </code></pre>
</div>
<p>Well, one nice way would be to have a single row for each name, and then have separate variables for the number of times that name is used for males and females. Using these two columns, we can then compute a third column that gives the ratio between these two columns. That is, we’d like to transform the data into a <strong>wide format</strong> with each of the possible values of the <code>sex</code> variable becoming its own column. The operation we need to perform this transformation is <strong><code>pivot_wider()</code></strong>.</p>
<p>The inputs for this function are:</p>
<ul>
<li><code>names_from</code> (the original variable <code>sex</code> in this case) that identifies the variable in the initial long format data whose values should become the names of the new variables in the wide format data.</li>
<li><code>names_sort = TRUE</code> dictates that the variables are listed in alphabetical order; when it is FALSE, they are listed in order of first appearance.</li>
<li><code>values_from</code> (<code>total</code> in this case) representing the variable to be divided into multiple new variables,</li>
<li><code>values_fill = 0</code> specifies that if there are, e.g., no females named Aadam, we should include a zero in the corresponding entry of the wide format table</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in knitr::include_graphics("images/pivot_wider.png"): Cannot find the file(s): "images/pivot_wider.png"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>BabyWide <span class="ot">&lt;-</span> babynamesTotal <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex, <span class="at">values_from =</span> total, <span class="at">values_fill =</span> <span class="dv">0</span>, <span class="at">names_sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>A wide format with one case per name enables us to examine gender balance.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Aaban</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">107</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aabha</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aabid</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aabir</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aabriella</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aada</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now we can choose common names with frequency greater than 25,000 for both males and females, and sort by the ratio to identify gender-neutral names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Neutral <span class="ot">&lt;-</span> BabyWide <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(M <span class="sc">&gt;</span> <span class="dv">25000</span>, F <span class="sc">&gt;</span> <span class="dv">25000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio =</span> <span class="fu">pmin</span>(M <span class="sc">/</span> F, F <span class="sc">/</span> M)) <span class="sc">%&gt;%</span> <span class="co">#pmin() stands for parallel min, finds the min(M/F, F/M) within each row</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ratio))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>The most gender-neutral common names, in wide format.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">M</th>
<th style="text-align: right;">ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Kerry</td>
<td style="text-align: right;">48534</td>
<td style="text-align: right;">49596</td>
<td style="text-align: right;">0.9785870</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riley</td>
<td style="text-align: right;">100881</td>
<td style="text-align: right;">92789</td>
<td style="text-align: right;">0.9197867</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Quinn</td>
<td style="text-align: right;">28283</td>
<td style="text-align: right;">31230</td>
<td style="text-align: right;">0.9056356</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jackie</td>
<td style="text-align: right;">90604</td>
<td style="text-align: right;">78405</td>
<td style="text-align: right;">0.8653591</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Frankie</td>
<td style="text-align: right;">33236</td>
<td style="text-align: right;">40552</td>
<td style="text-align: right;">0.8195897</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jaime</td>
<td style="text-align: right;">49673</td>
<td style="text-align: right;">67582</td>
<td style="text-align: right;">0.7350034</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Casey</td>
<td style="text-align: right;">76020</td>
<td style="text-align: right;">110165</td>
<td style="text-align: right;">0.6900558</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peyton</td>
<td style="text-align: right;">69256</td>
<td style="text-align: right;">47682</td>
<td style="text-align: right;">0.6884891</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pat</td>
<td style="text-align: right;">40123</td>
<td style="text-align: right;">26731</td>
<td style="text-align: right;">0.6662264</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jessie</td>
<td style="text-align: right;">167010</td>
<td style="text-align: right;">110027</td>
<td style="text-align: right;">0.6588049</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kendall</td>
<td style="text-align: right;">58026</td>
<td style="text-align: right;">33821</td>
<td style="text-align: right;">0.5828594</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jody</td>
<td style="text-align: right;">55691</td>
<td style="text-align: right;">31206</td>
<td style="text-align: right;">0.5603419</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="longer" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="longer">Longer</h3>
<p>Next, let’s filter these names to keep only those with a ratio of 0.5 or greater (no more than 2 to 1), and then switch back to long format. We can do this with the following <strong><code>pivot_longer()</code></strong> operation. It gathers the columns listed c(<code>F</code>,<code>M</code>) under the <code>cols</code> argument into a single column whose name is given by the <code>names_to</code> argument (“sex”), and includes the values in a column called <code>total</code>, which is the input to the <code>values_to</code> argument.</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in knitr::include_graphics("images/pivot_longer.png"): Cannot find the file(s): "images/pivot_longer.png"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>NeutralLong <span class="ot">&lt;-</span> Neutral <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ratio <span class="sc">&gt;=</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">F</span><span class="st">`</span>, <span class="st">`</span><span class="at">M</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">"sex"</span>, <span class="at">values_to =</span> <span class="st">"total"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, sex, total) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Long format for the most gender-neutral common names.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Casey</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">76020</td>
</tr>
<tr class="even">
<td style="text-align: left;">Casey</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">110165</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Frankie</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">33236</td>
</tr>
<tr class="even">
<td style="text-align: left;">Frankie</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">40552</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jackie</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">90604</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jackie</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">78405</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jaime</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">49673</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jaime</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">67582</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jessie</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">167010</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jessie</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">110027</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jody</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">55691</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jody</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">31206</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kendall</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">58026</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kendall</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">33821</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kerry</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">48534</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kerry</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">49596</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pat</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">40123</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pat</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">26731</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Peyton</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">69256</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peyton</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">47682</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Quinn</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">28283</td>
</tr>
<tr class="even">
<td style="text-align: left;">Quinn</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">31230</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Riley</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">100881</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riley</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">92789</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="example-the-daily-show-guests" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="example-the-daily-show-guests">Example: The Daily Show Guests</h2>
<p>The data associated with <a href="https://fivethirtyeight.com/datalab/every-guest-jon-stewart-ever-had-on-the-daily-show/">this article</a> is available in the <code>fivethirtyeight</code> package, and is loaded into <code>Daily</code> below. It includes a list of every guest to ever appear on Jon Stewart’s The Daily Show. Note that when multiple people appeared together, each person receives their own line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Daily <span class="ot">&lt;-</span> daily_show_guests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 35%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">google_knowledge_occupation</th>
<th style="text-align: left;">show</th>
<th style="text-align: left;">group</th>
<th style="text-align: left;">raw_guest_list</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">singer</td>
<td style="text-align: left;">1999-07-26</td>
<td style="text-align: left;">Musician</td>
<td style="text-align: left;">Donny Osmond</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actress</td>
<td style="text-align: left;">1999-07-27</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Wendie Malick</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">vocalist</td>
<td style="text-align: left;">1999-07-28</td>
<td style="text-align: left;">Musician</td>
<td style="text-align: left;">Vince Neil</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">film actress</td>
<td style="text-align: left;">1999-07-29</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Janeane Garofalo</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">comedian</td>
<td style="text-align: left;">1999-08-10</td>
<td style="text-align: left;">Comedy</td>
<td style="text-align: left;">Dom Irrera</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actor</td>
<td style="text-align: left;">1999-08-11</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Pierce Brosnan</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">director</td>
<td style="text-align: left;">1999-08-12</td>
<td style="text-align: left;">Media</td>
<td style="text-align: left;">Eduardo Sanchez and Daniel Myrick</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">film director</td>
<td style="text-align: left;">1999-08-12</td>
<td style="text-align: left;">Media</td>
<td style="text-align: left;">Eduardo Sanchez and Daniel Myrick</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">american television personality</td>
<td style="text-align: left;">1999-08-16</td>
<td style="text-align: left;">Media</td>
<td style="text-align: left;">Carson Daly</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actress</td>
<td style="text-align: left;">1999-08-17</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Molly Ringwald</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actress</td>
<td style="text-align: left;">1999-08-18</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Sarah Jessica Parker</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="practice-popular-guests" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="practice-popular-guests">Practice: Popular guests</h3>
<div class="cell">
<pre class="exercise cell-code"><code>Create the following table containing 19 columns. The first column should have the ten guests with the highest number of total apperances on the show, listed in descending order of number of appearances. The next 17 columns should show the number of appearances of the corresponding guest in each year from 1999 to 2015 (one per column). The final column should show the total number of appearances for the corresponding guest over the entire duration of the show (these entries should be in decreasing order). Hint: the function `rowSums()` adds up all of the entries in each row of a table. Try using it in a `mutate()`.
</code></pre>
</div>
</section>
<section id="practice-recreating-a-graphic" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="practice-recreating-a-graphic">Practice: Recreating a graphic</h3>
<p>The original data has 18 different entries for the <code>group</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Daily<span class="sc">$</span>group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Acting"         "Comedy"         "Musician"       "Media"         
 [5] NA               "Politician"     "Athletics"      "Business"      
 [9] "Advocacy"       "Political Aide" "Misc"           "Academic"      
[13] "Government"     "media"          "Clergy"         "Science"       
[17] "Consultant"     "Military"      </code></pre>
</div>
</div>
<p>In order to help you recreate the first figure from <a href="https://fivethirtyeight.com/datalab/every-guest-jon-stewart-ever-had-on-the-daily-show/">the article</a>, I have added a new variable with three broader groups: (i) entertainment; (ii) politics, business, and government, and (iii) commentators. The data is available <a href="data/daily-group-assignment.csv">here</a>. We will learn in the next activity what the <code>inner_join</code> in this code chunk is doing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>DailyGroups <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://bcheggeseth.github.io/112_spring_2023/data/daily-group-assignment.csv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Daily <span class="ot">&lt;-</span> Daily <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(DailyGroups, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"group"</span> <span class="ot">=</span> <span class="st">"group"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: 'data/daily-group-assignment.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/alhashimphd/mac-comp112website-f24/src').</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'DailyGroups' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 41%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">google_knowledge_occupation</th>
<th style="text-align: left;">show</th>
<th style="text-align: left;">group</th>
<th style="text-align: left;">raw_guest_list</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actor</td>
<td style="text-align: left;">1999-01-11</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Michael J. Fox</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">comedian</td>
<td style="text-align: left;">1999-01-12</td>
<td style="text-align: left;">Comedy</td>
<td style="text-align: left;">Sandra Bernhard</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">television actress</td>
<td style="text-align: left;">1999-01-13</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Tracey Ullman</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">film actress</td>
<td style="text-align: left;">1999-01-14</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">Gillian Anderson</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actor</td>
<td style="text-align: left;">1999-01-18</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">David Alan Grier</td>
</tr>
<tr class="even">
<td style="text-align: right;">1999</td>
<td style="text-align: left;">actor</td>
<td style="text-align: left;">1999-01-19</td>
<td style="text-align: left;">Acting</td>
<td style="text-align: left;">William Baldwin</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Using the group assignments contained in the `broad_group` variable, recreate the graphic from the article, with three different lines showing the fraction of guests in each group over time. Hint: first think about what your case should be for the glyph-ready form.
</code></pre>
</div>
</section>
</section>
<section id="more-practice-pivoting-longer" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="more-practice-pivoting-longer">More Practice: Pivoting Longer</h2>
<p>A typical situation that requires a <code>pivot_longer</code> command is when the columns represent the possible values of a variable. Table @ref(tab:lesotho-table) shows example data set from <a href="http://dataportal.opendataforafrica.org/">opendataforafrica.org</a> with different years in different columns. You can find the data <a href="data/Lesotho.csv">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Lesotho <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://bcheggeseth.github.io/112_spring_2023/data/Lesotho.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: 'data/Lesotho.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/alhashimphd/mac-comp112website-f24/src').</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Lesotho' not found</code></pre>
</div>
</div>
<div class="cell" name="Practice pivoting longer">
<pre class="exercise cell-code"><code>Make a side-by-side bar chart with the `year` on the horizontal axis, and three side-by-side vertical columns for average interest rate on deposits, average interest rate on loans, and inflation rate for each year. In order to get the data into glyph-ready form, you'll need to use `pivot_longer`. Hint: `pivot_longer` uses the `dplyr::select()` notation, so you can, e.g., list the columns you want to select, use colon notation, or use `starts_with(a string)`. See [Wickham and Grolemund](https://r4ds.had.co.nz/transform.html#select) for more information.
</code></pre>
</div>
</section>
<section id="appendix-r-functions" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="appendix-r-functions">Appendix: R Functions</h2>
<section id="reshaping-functions" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="reshaping-functions">Reshaping Functions</h3>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 39%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Function/Operator</th>
<th style="text-align: center;">Action</th>
<th style="text-align: right;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>pivot_wider()</code></td>
<td style="text-align: center;">Takes a long data set and spreads information in columns into many new variables (wider)</td>
<td style="text-align: right;"><code>babynamesTotal %&gt;% pivot_wider(names_from = sex, values_from = total, values_fill = 0, names_sort = TRUE)</code></td>
</tr>
<tr class="even">
<td><code>pivot_longer()</code></td>
<td style="text-align: center;">Takes a wide data set and gathers information in columns into fewer variables (longer)</td>
<td style="text-align: right;"><code>Neutral %&gt;% pivot_longer(cols = c(</code>F<code>,</code>M<code>), names_to = "sex", values_to = "total")</code></td>
</tr>
</tbody>
</table>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>