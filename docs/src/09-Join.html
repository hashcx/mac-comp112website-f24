<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>COMP/STAT 112: Introduction to Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/01-RStudio_Intro.html">Src</a></li><li class="breadcrumb-item"><a href="../src/09-Join.html">Joining Two Data Frames</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">COMP/STAT 112: Introduction to Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Src</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01-RStudio_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">P1: Intro to R, RStudio, and R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02-Intro_Data_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03-Effective_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effective Visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/04-Bivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">options(htmltools.dir.version = FALSE)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/05-Multivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate Visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/07-Six_Main_Verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/08-Reshaping_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reshaping Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/09-Join.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Joining Two Data Frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/10-Factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables as Factors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/11-Mini_Project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mini-Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/12-Data_Import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Acquisition &amp; Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/13-EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/14-Regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular Expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/15-Data_Scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Additional Topics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/16-API.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Public Web APIs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/17-SQL.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/18-Text_Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/19-Adv_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/21-Prez_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation Tools</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#joining-two-data-frames" id="toc-joining-two-data-frames" class="nav-link active" data-scroll-target="#joining-two-data-frames">Joining Two Data Frames</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals">Learning Goals</a></li>
  <li><a href="#joins" id="toc-joins" class="nav-link" data-scroll-target="#joins">Joins</a>
  <ul class="collapse">
  <li><a href="#establishing-a-match-between-cases" id="toc-establishing-a-match-between-cases" class="nav-link" data-scroll-target="#establishing-a-match-between-cases">Establishing a match between cases</a></li>
  <li><a href="#matching" id="toc-matching" class="nav-link" data-scroll-target="#matching">Matching</a></li>
  <li><a href="#mutating-joins" id="toc-mutating-joins" class="nav-link" data-scroll-target="#mutating-joins">Mutating joins</a></li>
  <li><a href="#filtering-joins" id="toc-filtering-joins" class="nav-link" data-scroll-target="#filtering-joins">Filtering joins</a></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice">Practice</a></li>
  </ul></li>
  <li><a href="#bicycle-use-patterns" id="toc-bicycle-use-patterns" class="nav-link" data-scroll-target="#bicycle-use-patterns">Bicycle-Use Patterns</a>
  <ul class="collapse">
  <li><a href="#warm-up-temporal-patterns" id="toc-warm-up-temporal-patterns" class="nav-link" data-scroll-target="#warm-up-temporal-patterns">Warm-up: Temporal patterns</a></li>
  <li><a href="#mutating-join-practice-spatial-patterns" id="toc-mutating-join-practice-spatial-patterns" class="nav-link" data-scroll-target="#mutating-join-practice-spatial-patterns">Mutating join practice: Spatial patterns</a></li>
  <li><a href="#filtering-join-practice-spatiotemporal-patterns" id="toc-filtering-join-practice-spatiotemporal-patterns" class="nav-link" data-scroll-target="#filtering-join-practice-spatiotemporal-patterns">Filtering join practice: Spatiotemporal patterns</a></li>
  </ul></li>
  <li><a href="#appendix-r-functions" id="toc-appendix-r-functions" class="nav-link" data-scroll-target="#appendix-r-functions">Appendix: R Functions</a>
  <ul class="collapse">
  <li><a href="#mutating-joins-1" id="toc-mutating-joins-1" class="nav-link" data-scroll-target="#mutating-joins-1">Mutating Joins</a></li>
  <li><a href="#filtering-joins-1" id="toc-filtering-joins-1" class="nav-link" data-scroll-target="#filtering-joins-1">Filtering Joins</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="joining-two-data-frames" class="level1">
<h1>Joining Two Data Frames</h1>
<section id="learning-goals" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learning-goals">Learning Goals</h2>
<ul>
<li>Understand the concept of keys and variables that uniquely identify rows or cases</li>
<li>Understand the different types of joins, different ways of combining two data frames together</li>
<li>Develop comfort in using mutating joins: <code>left_join</code>, <code>inner_join</code> and <code>full_join</code> in the <code>dplyr</code> package</li>
<li>Develop comfort in using filtering joins: <code>semi_join</code>, <code>anti_join</code> in the <code>dplyr</code> package</li>
</ul>
<p>You can download a template .Rmd of this activity <a href="template_rmd/09-Join_Assign.Rmd">here</a>. Put it in a folder <code>Assignment_06</code> in <code>COMP_STAT_112</code>.</p>
</section>
<section id="joins" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="joins">Joins</h2>
<p>A <em>join</em> is a verb that means to combine two data tables.</p>
<ul>
<li>These tables are often called the <em>left</em> and the <em>right</em> tables.</li>
</ul>
<p>There are several kinds of join.</p>
<ul>
<li>All involve establishing a correspondence — a match — between each case in the left table and zero or more cases in the right table.</li>
<li>The various joins differ in how they handle multiple matches or missing matches.</li>
</ul>
<section id="establishing-a-match-between-cases" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="establishing-a-match-between-cases">Establishing a match between cases</h3>
<p>A match between a case in the <em>left</em> data table and a case in the <em>right</em> data table is made based on the values in <strong>keys</strong>, variables that uniquely define observations in a data table.</p>
<p>As an example, we’ll examine the following two tables on grades and courses.</p>
<p>The <code>Grades</code> <a href="data/grades.csv">file</a> has one case for each class of each student (student-class pair), and includes variables describing the ID of the student (<code>sid</code>), the ID of the session (section of class), and the grade received.</p>
<p>The <code>Courses</code> <a href="data/courses.csv">file</a> has one case for each section of a class, and includes variables for the ID of the session (section of class), the department (coded as letters), the level, the semester, the enrollment, and the ID of the instructor (<code>iid</code>). We show a few rows of each table below.</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: 'data/grades.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/alhashimphd/mac-comp112website-f24/src').</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Grades' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Grades' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: 'data/courses.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/alhashimphd/mac-comp112website-f24/src').</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Courses' not found</code></pre>
</div>
</div>
<section id="keys" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="keys">Keys</h4>
<p>A <strong>primary key</strong> uniquely identifies an observation (a row or case) in its own data table.</p>
<p><code>sid</code> (student ID) and <code>sessionID</code> (class ID) are the primary keys for <code>Grades</code> as they unique identify each case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can check to make sure that there are no combinations of sid and session ID that have more than 1 row</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Grades <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sid, sessionID) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Grades' not found</code></pre>
</div>
</div>
<p><code>sessionID</code> (class ID) and <code>dept</code> are the primary keys for <code>Courses</code> as they unique identify each case. <em>You may have guessed that <code>sessionID</code> alone was sufficient as the key; however, if a course is cross-listed, then it may have multiple departments listed.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check to make sure that there are no combinations </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of session ID and dept that have more than 1 row</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Courses <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sessionID, dept) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Courses' not found</code></pre>
</div>
</div>
</section>
</section>
<section id="matching" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="matching">Matching</h3>
<p>In order to establish a match between two data tables,</p>
<ul>
<li><strong>You</strong> specify which variables (or keys) to use.</li>
<li>Each match is specify as a pair of variables, where one variable from the left table corresponds to one variable from the right table.</li>
<li>Cases must have <em>exactly equal</em> values in the left variable and right variable for a match to be made.</li>
</ul>
</section>
<section id="mutating-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="mutating-joins">Mutating joins</h3>
<p>The first class of joins are mutating joins, which add new variables (columns) to the left data table from matching observations in the right table.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The main difference in the three mutating join options in this class is how they answer the following questions:</p>
<ol type="1">
<li>What happens when a case in the left table has no matches in the right table?</li>
<li>What happens when a case in the right table has no matches in the left table?</li>
</ol>
<p>Three mutating join functions:</p>
<ul>
<li><strong><code>left_join()</code></strong>: the output has <em>all cases from the left</em>, regardless if there is a match in the right, but discards any cases in the right that do not have a match in the left.</li>
<li><strong><code>inner_join()</code></strong>: the output has <em>only the cases from the left with a match in the right</em>.</li>
<li><strong><code>full_join()</code></strong>: the output has <em>all cases from the left and the right</em>. This is less common than the first two join operators.</li>
</ul>
<p>When there are multiple matches in the right table for a particular case in the left table, all three of these mutating join operators produce a separate case in the new table for each of the matches from the right.</p>
<div class="cell" name="Average class size: varying viewpoints">
<pre class="example cell-code"><code>Determine the average class size from the viewpoint of a student (getting an average size for each student and the classes they take) and the viewpoint of the Provost / Admissions Office (getting an average size across all classes).
</code></pre>
</div>
<details>
<summary>
Solution
</summary>
<p><strong>Provost Perspective:</strong></p>
<p>The Provost counts each section as one class and takes the average of all classes. We have to be a little careful and cannot simply do <code>mean(Courses$enroll)</code>, because some <code>sessionID</code> appear twice on the course list. Why is that?<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> We can still do this from the data we have in the <code>Courses</code> table, but we should aggregate by <code>sessionID</code> first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>CourseSizes <span class="ot">&lt;-</span> Courses <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sessionID) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_enroll =</span> <span class="fu">sum</span>(enroll))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Courses' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(CourseSizes<span class="sc">$</span>total_enroll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'CourseSizes' not found</code></pre>
</div>
</div>
<p><strong>Student Perspective:</strong></p>
<p>To get the average class size from the student perspective, we can join the enrollment of the section onto each instance of a student section. Here, the left table is <code>Grades</code>, the right table is <code>CourseSizes</code>, we are going to match based on <code>sessionID</code>, and we want to add the variable <code>total_enroll</code> from <code>CoursesSizes</code>.</p>
<p>We’ll use a <code>left_join</code> since we aren’t interested in any sections from the <code>CourseSizes</code> table that do not show up in the <code>Grades</code> table; their enrollments should be 0, and they are not actually seen by any students. Note, e.g., if there were 100 extra sections of zero enrollments on the <code>Courses</code> table, this would change the average from the Provost’s perspective, but not at all from the students’ perspective.</p>
<p>If the <code>by =</code> is omitted from a join, then <code>R</code> will perform a <em>natural join</em>, which matches the two tables by all variables they have in common. In this case, the only variable in common is the <code>sessionID</code>, so we would get the same results by omitting the second argument. In general, this is not reliable unless we check ahead of time which variables the tables have in common. If two variables to match have different names in the two tables, we can write <code>by = c("name1" = "name2")</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>EnrollmentsWithClassSize <span class="ot">&lt;-</span> Grades <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(CourseSizes,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sessionID"</span> <span class="ot">=</span> <span class="st">"sessionID"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sid, sessionID, total_enroll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Grades' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'EnrollmentsWithClassSize' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>AveClassEachStudent <span class="ot">&lt;-</span> EnrollmentsWithClassSize <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ave_enroll =</span> <span class="fu">mean</span>(total_enroll, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'EnrollmentsWithClassSize' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'AveClassEachStudent' not found</code></pre>
</div>
</div>
<p>The <code>na.rm = TRUE</code> here says that if the class size is not available for a given class, we do not count that class towards the student’s average class size. What is another way to capture the same objective? We could have used an <code>inner_join</code> instead of a <code>left_join</code> when we joined the tables to eliminate any entries from the left table that did not have a match in the right table.</p>
<p>Now we can take the average of the <code>AveClassEachStudent</code> table, counting each student once, to find the average class size from the student perspective:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(AveClassEachStudent<span class="sc">$</span>ave_enroll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'AveClassEachStudent' not found</code></pre>
</div>
</div>
We see that the average size from the student perspective (24.4) is greater than the average size from the Provost’s perspective (21.5).
</details>
</section>
<section id="filtering-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="filtering-joins">Filtering joins</h3>
<p>The second class of joins are filtering joins, which select specific cases from the left table based on whether they match an observation in the right table.</p>
<ul>
<li><strong><code>semi_join()</code></strong>: discards any cases in the left table that <em>do not have a match</em> in the right table. If there are multiple matches of right cases to a left case, it keeps just one copy of the left case.</li>
<li><strong><code>anti_join()</code></strong>: discards any cases in the left table that <em>have a match</em> in the right table.</li>
</ul>
<p>A particularly common employment of these joins is to use a filtered summary as a comparison to select a subset of the original cases, as follows.</p>
<div class="cell" name="semi_join to compare to a filtered summary">
<pre class="example cell-code"><code>Find a subset of the `Grades` data that only contains data on the four largest sections in the `Courses` data set.
</code></pre>
</div>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>LargeSections <span class="ot">&lt;-</span> Courses <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sessionID) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_enroll =</span> <span class="fu">sum</span>(enroll)) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_enroll)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Courses' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>GradesFromLargeSections <span class="ot">&lt;-</span> Grades <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(LargeSections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Grades' not found</code></pre>
</div>
</div>
</details>
<div class="cell" name="semi_join">
<pre class="example cell-code"><code>Use `semi_join()` to create a table with a subset of the rows of `Grades` corresponding to all classes taken in department `J`.
</code></pre>
</div>
<details>
<summary>
Solution
</summary>
<p>There are multiple ways to do this. We could do a left join to the <code>Grades</code> table to add on the <code>dept</code> variable, and then filter by department, then select all variables except the additional <code>dept</code> variable we just added. Here is a more direct way with <code>semi_join</code> that does not involve adding and subtracting the extra variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>JCourses <span class="ot">&lt;-</span> Courses <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dept <span class="sc">==</span> <span class="st">"J"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Courses' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>JGrades <span class="ot">&lt;-</span> Grades <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(JCourses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Grades' not found</code></pre>
</div>
</div>
<p>Let’s double check this worked. Here are the first few entries of our new table:</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'JGrades' not found</code></pre>
</div>
</div>
<p>The first entry is for <code>session1791</code>. Which department is that course in? What department should it be?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(Courses <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sessionID <span class="sc">==</span> <span class="st">"session1791"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'Courses' not found</code></pre>
</div>
</div>
<p>Great, it worked! But that only checked the first one. What if we want to double check all of the courses included in Table @ref(tab:jtab)? We can add on the department and do a group by to count the number from each department in our table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>JGrades <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Courses) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dept) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'JGrades' not found</code></pre>
</div>
</div>
</details>
</section>
<section id="practice" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="practice">Practice</h3>
<div class="cell">
<pre class="exercise cell-code"><code>Use all of your wrangling skills to answer the following questions.</code></pre>
</div>
<p><em>Hint 1: start by thinking about what tables you might need to join (if any) and identifying the corresponding variables to match.</em> <em>Hint 2: you’ll need an extra table to convert grades to grade point averages. I’ve given you the code below.</em></p>
<ol type="a">
<li>How many student enrollments in each department?</li>
<li>What’s the grade-point average (GPA) for each student? The average student GPA? <em>Hint: There are some “S” and “AU” grades that we want to exclude from GPA calculations. What is the correct variant of join to accomplish this?</em></li>
<li>What fraction of grades are below B+?</li>
<li>What’s the grade-point average for each instructor?</li>
<li>Estimate the grade-point average for each department. <em>We cannot actually compute the correct grade-point average for each department from the information we have. The reason why is due to cross-listed courses. Students for those courses could be enrolled under either department, and we do not know which department to assign the grade to. There are a number of possible workarounds to get an estimate. One would be to assign all grades in a section to the department of the instructor, which we’d have to infer from the data.</em> For this exercise, start by creating a table with all cross-listed courses. Then use an <code>anti_join</code> to eliminate all cross-listed courses. Finally, use an <code>inner_join</code> to compute the grade-point average for each department.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>(GPAConversion <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">grade =</span> <span class="fu">c</span>(<span class="st">"A+"</span>, <span class="st">"A"</span>, <span class="st">"A-"</span>, <span class="st">"B+"</span>, <span class="st">"B"</span>, <span class="st">"B-"</span>, <span class="st">"C+"</span>, <span class="st">"C"</span>, <span class="st">"C-"</span>, <span class="st">"D+"</span>, <span class="st">"D"</span>, <span class="st">"D-"</span>, <span class="st">"NC"</span>), <span class="at">gp =</span> <span class="fu">c</span>(<span class="fl">4.3</span>, <span class="dv">4</span>, <span class="fl">3.7</span>, <span class="fl">3.3</span>, <span class="dv">3</span>, <span class="fl">2.7</span>, <span class="fl">2.3</span>, <span class="dv">2</span>, <span class="fl">1.7</span>, <span class="fl">1.3</span>, <span class="dv">1</span>, <span class="fl">0.7</span>, <span class="dv">0</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   grade    gp
   &lt;chr&gt; &lt;dbl&gt;
 1 A+      4.3
 2 A       4  
 3 A-      3.7
 4 B+      3.3
 5 B       3  
 6 B-      2.7
 7 C+      2.3
 8 C       2  
 9 C-      1.7
10 D+      1.3
11 D       1  
12 D-      0.7
13 NC      0  </code></pre>
</div>
</div>
</section>
</section>
<section id="bicycle-use-patterns" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="bicycle-use-patterns">Bicycle-Use Patterns</h2>
<p>In this activity, you’ll examine some factors that may influence the use of bicycles in a bike-renting program. The data come from Washington, DC and cover the last quarter of 2014.</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in knitr::include_graphics("images/bike_station.jpeg"): Cannot find the file(s): "images/bike_station.jpeg"</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in knitr::include_graphics("images/bike_van.jpeg"): Cannot find the file(s): "images/bike_van.jpeg"</code></pre>
</div>
</div>
<p>Two data tables are available:</p>
<ul>
<li><code>Trips</code> contains records of individual rentals <a href="data/2014-Q4-Trips-History-Data-Small.rds">here</a></li>
<li><code>Stations</code> gives the locations of the bike rental stations <a href="data/DC-Stations.csv">here</a></li>
</ul>
<p>Here is the code to read in the data:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gzfile(file, "rb"): cannot open compressed file
'data/2014-Q4-Trips-History-Data-Small.rds', probable reason 'No such file or
directory'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in gzfile(file, "rb"): cannot open the connection</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: 'data/DC-Stations.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/alhashimphd/mac-comp112website-f24/src').</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>data_site <span class="ot">&lt;-</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://bcheggeseth.github.io/112_spring_2023/data/2014-Q4-Trips-History-Data-Small.rds"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>Trips <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">gzcon</span>(<span class="fu">url</span>(data_site)))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Stations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://bcheggeseth.github.io/112_spring_2023/data/DC-Stations.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>Trips</code> data table is a random subset of 10,000 trips from the full quarterly data.</p>
<section id="warm-up-temporal-patterns" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="warm-up-temporal-patterns">Warm-up: Temporal patterns</h3>
<p>It’s natural to expect that bikes are rented more at some times of day, some days of the week, some months of the year than others. The variable <code>sdate</code> gives the time (including the date) that the rental started.</p>
<div class="cell" name="Warm-up: temporal patterns">
<pre class="exercise cell-code"><code>Make the following plots and interpret them:</code></pre>
</div>
<ol type="a">
<li>A density plot of the events versus <code>sdate</code>. Use <code>ggplot()</code> and <code>geom_density()</code>.</li>
<li>A density plot of the events versus time of day. You can use <code>mutate</code> with <code>lubridate::hour()</code>, and <code>lubridate::minute()</code> to extract the hour of the day and minute within the hour from <code>sdate</code>. Hint: A minute is 1/60 of an hour, so create a field where 3:30 is 3.5 and 3:45 is 3.75.</li>
<li>A bar plot of the events versus day of the week.</li>
<li>Facet your graph from (b) by day of the week. Is there a pattern?</li>
</ol>
<p>The variable <code>client</code> describes whether the renter is a regular user (level <code>Registered</code>) or has not joined the bike-rental organization (<code>Causal</code>). Do you think these two different categories of users show different rental behavior? How might it interact with the patterns you found in Exercise @ref(exr:exr-temp)?</p>
<div class="cell" name="Customer segmentation">
<pre class="exercise cell-code"><code>Repeat the graphic from Exercise \@ref(exr:exr-temp) (d) with the following changes:</code></pre>
</div>
<ol type="a">
<li>Set the <code>fill</code> aesthetic for <code>geom_density()</code> to the <code>client</code> variable. You may also want to set the <code>alpha</code> for transparency and <code>color=NA</code> to suppress the outline of the density function.</li>
<li>Now add the argument <code>position = position_stack()</code> to <code>geom_density()</code>. In your opinion, is this better or worse in terms of telling a story? What are the advantages/disadvantages of each?</li>
<li>Rather than faceting on day of the week, create a new faceting variable like this: <code>mutate(wkday = ifelse(lubridate::wday(sdate) %in% c(1,7), "weekend", "weekday"))</code>. What does the variable <code>wkday</code> represent? Try to understand the code.</li>
<li>Is it better to facet on <code>wkday</code> and fill with <code>client</code>, or vice versa?</li>
<li>Of all of the graphics you created so far, which is most effective at telling an interesting story?</li>
</ol>
</section>
<section id="mutating-join-practice-spatial-patterns" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="mutating-join-practice-spatial-patterns">Mutating join practice: Spatial patterns</h3>
<div class="cell" name="Visualization of bicycle departures by station">
<pre class="exercise cell-code"><code>Use the latitude and longitude variables in `Stations` to make a visualization of the total number of departures from each station in the `Trips` data. To layer your data on top of a  map, start your plotting code as follows:
</code></pre>
</div>
<pre><code>myMap&lt;-get_stamenmap(c(-77.1,38.87,-76.975,38.95),zoom=14,maptype="terrain") 
ggmap(myMap) + ...</code></pre>
<p>Note: If you want to use Google Maps instead, which do look a bit nicer, you’ll need to get a Google Maps API Key (free but requires credit card to sign up), and then you can use <code>get_map</code> instead of <code>get_stamenmap</code>.</p>
<div class="cell">
<pre class="exercise cell-code"><code>Only 14.4% of the trips in our data are carried out by casual users.^[We can compute this statistic via `mean(Trips$client=="Casual")`.] Create a map that shows which area(s) of the city have stations with a much higher percentage of departures by casual users. Interpret your map.
</code></pre>
</div>
</section>
<section id="filtering-join-practice-spatiotemporal-patterns" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="filtering-join-practice-spatiotemporal-patterns">Filtering join practice: Spatiotemporal patterns</h3>
<div class="cell" name="High traffic points">
<pre class="exercise cell-code"><code>Consider the following:

(a) Make a table with the ten station-date combinations (e.g., 14th &amp; V St., 2014-10-14) with the highest number of departures, sorted from most departures to fewest. Hint: `as_date(sdate)` converts `sdate` from date-time format to date format.
(b) Use a join operation to make a table with only those trips whose departures match those top ten station-date combinations from part (a).
(c) Group the trips you filtered out in part (b) by client type and `wkday` (weekend/weekday), and count the total number of trips in each of the four groups. Interpret your results.
</code></pre>
</div>
</section>
</section>
<section id="appendix-r-functions" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="appendix-r-functions">Appendix: R Functions</h2>
<section id="mutating-joins-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="mutating-joins-1">Mutating Joins</h3>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 39%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Function/Operator</th>
<th style="text-align: center;">Action</th>
<th style="text-align: right;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>left_join()</code></td>
<td style="text-align: center;">Joins two data sets together (adding variables from right to left data sets), keeping all rows of the left or 1st dataset</td>
<td style="text-align: right;"><code>Grades %&gt;% left_join(CourseSizes, by = c("sessionID" = "sessionID"))</code></td>
</tr>
<tr class="even">
<td><code>inner_join()</code></td>
<td style="text-align: center;">Joins two data sets together (adding variables from right to left data sets), keeping only rows in left that have a match in right</td>
<td style="text-align: right;"><code>Grades %&gt;% inner_join(GPAConversion)</code></td>
</tr>
<tr class="odd">
<td><code>full_join()</code></td>
<td style="text-align: center;">Joins two data sets together (adding variables from right to left data sets), keeping all rows of both left and right datasets</td>
<td style="text-align: right;"><code>Grades %&gt;% full_join(CourseSizes, by = c("sessionID" = "sessionID"))</code></td>
</tr>
</tbody>
</table>
</section>
<section id="filtering-joins-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="filtering-joins-1">Filtering Joins</h3>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 39%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Function/Operator</th>
<th style="text-align: center;">Action</th>
<th style="text-align: right;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>semi_join()</code></td>
<td style="text-align: center;">Keep only rows in left that have a match in right</td>
<td style="text-align: right;"><code>Grades %&gt;% semi_join(LargeSections)</code></td>
</tr>
<tr class="even">
<td><code>anti_join()</code></td>
<td style="text-align: center;">Keep only rows in left that don’t have a match in right</td>
<td style="text-align: right;"><code>Grades %&gt;% anti_join(CrossListedSections)</code></td>
</tr>
</tbody>
</table>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There is also a <code>right_join()</code> that adds variables in the reverse direction from the left table to the right table, but we do not really need it as we can always switch the roles of the two tables.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>They are courses that are cross-listed in multiple departments!<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><strong>Important</strong>: To avoid repeatedly re-reading the files, start the data import chunk with <code>{r cache = TRUE}</code> rather than the usual <code>{r}</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>