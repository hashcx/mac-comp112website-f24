<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.4.555" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />


<title>COMP/STAT 112: Introduction to Data Science – 12  Public Web APIs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<link rel="stylesheet" href="../styles/styles.css" />
</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn"
      data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs"></h1>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      COMP/STAT 112: Introduction to Data Science
      </a> 
        <div class="sidebar-tools-main">
    <a href="/COMP-STAT-112--Introduction-to-Data-Science.pdf"  title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Foundation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/01-RStudio_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>1</span>  <span class='chapter-title'>Intro to R, RStudio, and R Markdown</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/02-Intro_Data_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/03-Effective_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>2</span>  <span class='chapter-title'>Effective Visualizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/04-Bivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>3</span>  <span class='chapter-title'>options(htmltools.dir.version = FALSE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/05-Multivariate_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>4</span>  <span class='chapter-title'>Multivariate Visualizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/06-Spatial_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>5</span>  <span class='chapter-title'>Spatial Visualization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/07-Six_Main_Verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/08-Reshaping_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>6</span>  <span class='chapter-title'>Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/09-Join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>7</span>  <span class='chapter-title'>Joining Two Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/10-Factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>8</span>  <span class='chapter-title'>Categorical Variables as Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/11-Mini_Project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>9</span>  <span class='chapter-title'>Mini-Project</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Data Acquisition & Cleaning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/12-Data_Import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data Acquisition & Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/13-EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>10</span>  <span class='chapter-title'>Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/14-Regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>11</span>  <span class='chapter-title'>Regular Expressions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Additional Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/15-Data_Scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Additional Topics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/16-API.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class='chapter-number'>12</span>  <span class='chapter-title'>Public Web APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/17-SQL.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/19-Adv_Viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/20-Shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>13</span>  <span class='chapter-title'>library(flair)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/src/21-Prez_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation Tools</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>  <span class="chapter-title">Public Web APIs</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals">Learning Goals</a></li>
  <li><a href="#apis" id="toc-apis">APIs</a></li>
  <li><a href="#wrapper-packages" id="toc-wrapper-packages">Wrapper Packages</a></li>
  <li><a href="#accessing-web-apis" id="toc-accessing-web-apis">Accessing Web APIs</a></li>
  <li><a href="#web-api-responses" id="toc-web-api-responses">Web API Responses</a>
  <ul>
  <li><a href="#a-note-on-nested-data-frames" id="toc-a-note-on-nested-data-frames">A Note on Nested Data Frames</a></li>
  </ul></li>
  <li><a href="#additional-practice" id="toc-additional-practice">Additional Practice</a></li>
  </ul>
</nav>
<section id="learning-goals" class="level2 unnumbered">
<h2 class="unnumbered">Learning Goals</h2>
<ul>
<li>Understand the difference between acquiring data through web scraping vs. a web API</li>
<li>Set up an API key for a public API</li>
<li>Develop comfort in using a wrapper package or url-method of calling a web API</li>
<li>Recognize the structure in a url for a web API and adjust for your purposes</li>
</ul>
<p>You can download a template .Rmd of this activity <a href="template_rmd/16-API.Rmd">here</a>.</p>
</section>
<section id="apis" class="level2 unnumbered">
<h2 class="unnumbered">APIs</h2>
<p>In this lesson you’ll learn how to collect data from websites such as The New York Times, Zillow, and Google. While these sites are primarily known for the information they provide to humans browsing the web, they (along with most large websites) also provide information to computer programs.</p>
<p>Humans use browsers such as Firefox or Chrome to navigate the web. Behind the scenes, our browsers communicate with web servers using a technology called <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> or Hypertext Transfer Protocol.</p>
<p>Programming languages such as R can also use HTTP to communicate with web servers. We have seen how it is possible for R to “scrape” data from almost any static web page. However, it’s easiest to interact with websites that are specifically designed to communicate with programs. These <a href="https://en.wikipedia.org/wiki/Web_API">Web APIs</a>, or Web Application Programming Interfaces, focus on transmitting data, rather than images, colors, or other appearance-related information.</p>
<p>An large variety of web APIs provide data accessible to programs written in R (and almost any other programming language!). Almost all reasonably large commercial websites offer APIs. Todd Motto has compiled an excellent list of <a href="https://github.com/toddmotto/public-apis">Public Web APIs</a> on GitHub. Browse the list to see what kind of information is available.</p>
</section>
<section id="wrapper-packages" class="level2 unnumbered">
<h2 class="unnumbered">Wrapper Packages</h2>
<p>Possible readings: <br> 1. <a href="https://developer.nytimes.com/?mcubz=3">NY Times API</a> <br> 2. <a href="https://open.blogs.nytimes.com/2009/02/04/announcing-the-article-search-api/?mcubz=3&amp;_r=0">NY Times Blog post announcing the API</a> <br> 3. <a href="https://www.storybench.org/working-with-the-new-york-times-api-in-r/">Working with the NY Times API in <code>R</code></a><br />
4. <a href="https://github.com/mkearney/nytimes">nytimes pacakge for accessing the NY Times’ APIs from <code>R</code></a> <br> 5. <a href="https://www.youtube.com/watch?v=3at3YTAFbxs">Video showing how to use the NY Times API</a> <br> 6. <a href="https://ropensci.org/packages/">rOpenSci</a> has a good collection of wrapper packages</p>
<p>In R, it is easiest to use Web APIs through a <em>wrapper package</em>, an R package written specifically for a particular Web API. The R development community has already contributed wrapper packages for most large Web APIs. To find a wrapper package, search the web for “R Package” and the name of the website. For example, a search for “R Reddit Package” returns <a href="https://cran.r-project.org/web/packages/RedditExtractoR/index.html">RedditExtractor</a> and a search for “R Weather.com Package” surfaces <a href="https://ram-n.github.io/weatherData/">weatherData</a>.</p>
<p>This activity will build on the <a href="https://developer.nytimes.com/">New York Times Web API</a>, which provides access to news articles, movie reviews, book reviews, and many other data. Our activity will specifically focus on the <a href="https://developer.nytimes.com/docs/articlesearch-product/1/overview">Article Search API</a>, which finds information about news articles that contain a particular word or phrase.</p>
<p>We will use the <a href="https://github.com/mkearney/nytimes">nytimes</a> package that provides functions for some (but not all) of the NYTimes APIs. First, install the package by copying the following two lines into your console (you just need to run these once):</p>
<pre><code>install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;mkearney/nytimes&quot;)</code></pre>
<p>Next, take a look at the Article Search API example on the <a href="https://github.com/mkearney/nytimes">package website</a> to get a sense of the syntax.</p>
<div class="cell">
<pre class="exercise cell-code"><code>What do you think the nytimes function below does? How does it communicate with the NY Times? Where is the data about articles stored?
</code></pre>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">nyt_search</span>(<span class="at">q =</span> <span class="st">&quot;gamergate&quot;</span>, <span class="at">n =</span> <span class="dv">20</span>, <span class="at">end_date =</span> <span class="st">&quot;20150101&quot;</span>)</span></code></pre></div>
</div>
<p>To get started with the NY Times API, you must <a href="https://developer.nytimes.com/accounts/create">register and get an <strong>authentication key</strong></a>. Signup only takes a few seconds, and it lets the New York Times make sure nobody abuses their API for commercial purposes. It also <strong>rate limits</strong> their API and ensures programs don’t make too many requests per day. For the NY Times API, this limit is 1000 calls per day. Be aware that most APIs do have rate limits — especially for their free tiers.</p>
<p>Once you have signed up, verified your email, log back in to https://developer.nytimes.com. Under your email address, click on Apps and Create a new App (call it First API) and enable Article Search API, then press Save. This creates an <strong>authentication key</strong>, which is a 32 digit string with numbers and the letters a-e.</p>
<p>Store this in a variable as follows (this is just an example ID, not an actual one):</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>times_key <span class="ot">&lt;-</span> <span class="st">&quot;c935b213b2dc1218050eec976283dbbd&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell nytimes what our API key is</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">NYTIMES_KEY =</span> times_key)</span></code></pre></div>
</div>
<p>Now, let’s use the key to issue our first API call. We’ll adapt the code we see in the vignette to do what we need.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nytimes)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in library(nytimes): there is no package called &#39;nytimes&#39;</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Issue our first API call</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">nyt_search</span>(<span class="at">q =</span> <span class="st">&quot;gamergate&quot;</span>, <span class="at">n =</span> <span class="dv">20</span>, <span class="at">end_date =</span> <span class="st">&quot;20150101&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in nyt_search(q = &quot;gamergate&quot;, n = 20, end_date = &quot;20150101&quot;): could not find function &quot;nyt_search&quot;</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert response object to data frame</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res&#39; not found</code></pre>
</div>
</div>
<p>Something magical just happened. Your computer sent a message to the New York Times and asked for information about 20 articles about <a href="https://en.wikipedia.org/wiki/Gamergate_controversy">Gamergate</a> starting at January 1, 2015 and going backwards in time. Thousands of public Web APIs allow your computer to tap into almost any piece of public digital information on the web.</p>
<p>Let’s take a peek at the structure of the results. You can also look at the data in the “Environment” tab in one of the windows of RStudio:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(res)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res<span class="sc">$</span>web_url)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res<span class="sc">$</span>headline)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res<span class="sc">$</span>pub_date)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res&#39; not found</code></pre>
</div>
</div>
</section>
<section id="accessing-web-apis" class="level2 unnumbered">
<h2 class="unnumbered">Accessing Web APIs</h2>
<p>Wrapper packages such as <code>nytimes</code> provide a convenient way to interact with Web APIs. However, many Web APIs have incomplete wrapper packages, or no wrapper package at all. Fortunately, most Web APIs share a common structure that <code>R</code> can access relatively easily. There are two parts to each Web API: the <strong>request</strong>, which corresponds to a function call, and the <strong>response</strong>, which corresponds to the function’s return value.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>As mentioned earlier, a Web API call differs from a regular function call in that the request is sent over the Internet to a webserver, which performs the computation and calculates the return result, which is sent back over the Internet to the original computer.</p>
<p><strong>Web API Requests</strong></p>
<p>Possible readings: <br> 1. <a href="https://www.tutorialspoint.com/html/understanding_url_tutorial.htm">Understanding URLs</a> <br> 2. <a href="https://cran.r-project.org/web/packages/urltools/vignettes/urltools.html">urltools Vignette</a></p>
<p>The request for a Web API call is usually encoded through the <a href="https://www.tutorialspoint.com/html/understanding_url_tutorial.htm">URL</a>, the web address associated with the API’s webserver. Let’s look at the URL associated with the first <code>nytimes</code> <code>nyt_search</code> example we did. Open the following URL in your browser (you should replace MY_KEY with the api key you were given earlier).</p>
<pre><code>http://api.nytimes.com/svc/search/v2/articlesearch.json?q=gamergate&amp;api-key=MY_KEY</code></pre>
<p>The text you see in the browser is the response data. We’ll talk more about that in a bit. Right now, let’s focus on the structure of the URL. You can see that it has a few parts:</p>
<ul>
<li><code>http://</code> — The <strong>scheme</strong>, which tells your browser or program how to communicate with the webserver. This will typically be either <code>http:</code> or <code>https:</code>.</li>
<li><code>api.nytimes.com</code> — The <strong>hostname</strong>, which is a name that identifies the webserver that will process the request.</li>
<li><code>/svc/search/v2/articlesearch.json</code> — The <strong>path</strong>, which tells the webserver what function you would like to call.</li>
<li><code>?q=gamergate&amp;api-key=MY_KEY</code> — The <strong>query parameters</strong>, which provide the parameters for the function you would like to call. Note that the query can be thought of as a table, where each row has a key and a value (known as a key-value pair). In this case, the first row has key <code>q</code> and value <code>gamergate</code> and the second row has value <code>MY_KEY</code>. The query parameters are preceded by a <code>?</code>. Rows in the key-value table are separated by ‘&amp;’, and individual key-value pairs are separated by an <code>=</code>.</li>
</ul>
<p>Typically, each of these URL components will be specified in the API documentation. Sometimes, the scheme, hostname, and path (<code>http://api.nytimes.com/svc/search/v2/articlesearch.json</code>) will be referred to as the <a href="https://en.wikipedia.org/wiki/Web_API#Endpoints">endpoint</a> for the API call.</p>
<p>We will use the <code>urltools</code> module to build up a full URL from its parts. We start by creating a string with the endpoint and then add the parameters one by one using <code>param_set</code> and <code>url_encode</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urltools)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://api.nytimes.com/svc/search/v2/articlesearch.json&quot;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;q&quot;</span>, <span class="fu">url_encode</span>(<span class="st">&quot;marlon james&quot;</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;api-key&quot;</span>, <span class="fu">url_encode</span>(times_key))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>url</span></code></pre></div>
</div>
<p>Copy and paste the resulting URL into your browser to see what the NY Times response looks like!</p>
<div class="cell">
<pre class="exercise cell-code"><code>You may be wondering why we need to use `param_set` and `url_encode` instead of writing the full url by hand. This exercise will illustrate why we need to be careful. 

 a) Repeat the above steps, but create a URL that finds articles related to `Ferris Bueller&#39;s Day Off` (note the apostrophe). What is interesting about how the title appears in the URL?
 b) Repeat the steps above for the phrase `Nico &amp; Vinz` (make sure you use the punctuation mark `&amp;`). What do you notice?
 c) Take a look at the Wikipedia page describing [percent encoding](https://en.wikipedia.org/wiki/Percent-encoding). Explain how the process works in your own words.
</code></pre>
</div>
</section>
<section id="web-api-responses" class="level2 unnumbered">
<h2 class="unnumbered">Web API Responses</h2>
<p>Possible readings: <br> 1. <a href="https://blog.scottlowe.org/2013/11/08/a-non-programmers-introduction-to-json/">A Non-Programmer’s Introduction to JSON</a> <br> 2. <a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html">Getting Started With JSON and jsonlite</a> <br> 3. <a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-apis.html">Fetching JSON data from REST APIs</a></p>
<p>We now discuss the structure of the web response, the return value of the Web API function. Web APIs generate string responses. If you visited the earlier New York Times API link in your browser, you would be shown the string response from the New York Times webserver:</p>
<pre><code>{&quot;status&quot;:&quot;OK&quot;,&quot;copyright&quot;:&quot;Copyright (c) 2021 The New York Times Company. All Rights Reserved.&quot;,&quot;response&quot;:{&quot;docs&quot;:[{&quot;abstract&quot;:&quot;Here’s what you need to know.&quot;,&quot;web_url&quot;:&quot;https://www.nytimes.com/2019/08/16/briefing/rashida-tlaib-gamergate-greenland.html&quot;,&quot;snippet&quot;:&quot;Here’s what you need to know.&quot;,&quot;lead_paragraph&quot;:&quot;(Want to get this briefing by email? Here’s the sign-up.)&quot;,&quot;source&quot;:&quot;The New York Times&quot;,&quot;multimedia&quot;:[{&quot;rank&quot;:0,&quot;subtype&quot;:&quot;xlarge&quot;,&quot;caption&quot;:null,&quot;credit&quot;:null,&quot;type&quot;:&quot;image&quot;,&quot;url&quot;:&quot;images/2019/08/16/world/16US-AMBRIEFING-TLAIB-amcore/merlin_158003643_c67928bc-e547-4a2e-9344-5f0209ca024d-articleLarge.jpg&quot;,&quot;height&quot;:400,&quot;width&quot;:600,&quot;legacy&quot;:{&quot;xlarge&quot;:&quot;images/2019/08/16/world/16US-AMBRIEFING-TLAIB-amcore/merlin_158003643_c67928bc-e547-4a2e-9344-5f0209ca024d-articleLarge.jpg&quot;,&quot;xlargewidth&quot;:600,&quot;xlargeheight&quot;:400},&quot;subType&quot;:&quot;xlarge&quot;,&quot;crop_name&quot;:&quot;articleLarge&quot;},...</code></pre>
<p>If you stared very hard at the above response, you may be able to interpret it. However, it would be much easier to interact with the response in some more structured, programmatic way. The vast majority of Web APIs, including the New York Times, use a standard called JSON (Javascript Object Notation) to take data and encode it as a string. To understand the structure of JSON, take the NY Times web response in your browser, and copy and paste it into an online <a href="https://jsonformatter.curiousconcept.com/">JSON formatter</a>. The formatter will add newlines and tabs to make the data more human interpretable. You’ll see the following:</p>
<pre><code>{  
   &quot;status&quot;:&quot;OK&quot;,
   &quot;copyright&quot;:&quot;Copyright (c) 2021 The New York Times Company. All Rights Reserved.&quot;,
   &quot;response&quot;:{  
      &quot;docs&quot;:[  
      
        # A HUGE piece of data, with one object for each of the result articles
        
      ],
      &quot;meta&quot;:{  
         &quot;hits&quot;:128,
         &quot;offset&quot;:0,
         &quot;time&quot;:93
      }
   }
}     </code></pre>
<p>You’ll notice a few things in the JSON above:</p>
<ul>
<li>Strings are enclosed in double quotes, for example <code>"status"</code> and <code>"OK"</code>.</li>
<li>Numbers are written plainly, like <code>2350</code> or <code>72</code>.</li>
<li>Some data is enclosed in square brackets <code>[</code> and <code>]</code>. These data containers can be thought of as R lists.</li>
<li>Some data is enclosed in curly braces <code>{</code> and <code>}</code>. These data containers are called <em>Objects</em>. An object can be thought of as a single observation in a table. The columns or variables for the observation appear as <strong>keys</strong> on the left (<code>hits</code>, <code>offset</code>, etc.). The <strong>values</strong> appear after the specific key separated by a colon (<code>2350</code>, and <code>0</code>, respectively). Thus, we can think of the <code>meta</code> object above as:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" data-quarto-postprocess="true" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">hits</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">offset</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">128</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">93</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Let’s repeat the NY Times search for gamergate, but this time we will peform the Web API call by hand instead of using the <code>nytimes</code> wrapper package. We will use the <code>jsonlite</code> package to retrieve the response from the webserver and turn the string response into an <code>R</code> object. The <code>fromJson</code> function sends our request out over and across the web to the NY Times webserver, retrieves it, and turns it from a JSON-formatted string into R data.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rebuild the URL</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://api.nytimes.com/svc/search/v2/articlesearch.json&quot;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;q&quot;</span>, <span class="fu">url_encode</span>(<span class="st">&quot;gamergate&quot;</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;api-key&quot;</span>, <span class="fu">url_encode</span>(times_key))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;times_key&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Send the request to the webserver over the Internet and</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve the JSON response. Turn the JSON response into an</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># R Object.</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>response_js <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in open.connection(con, &quot;rb&quot;): cannot open URL
&#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=gamergate&#39;: HTTP
status was &#39;401 Unauthorized&#39;</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in open.connection(con, &quot;rb&quot;): cannot open the connection to &#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=gamergate&#39;</code></pre>
</div>
</div>
<p>The <code>jsonlite</code> makes the keys and values of an object available as attributes. For example, we can fetch the status:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>response_js<span class="sc">$</span>status</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;response_js&#39; not found</code></pre>
</div>
</div>
<p>While some keys in the object are associated with simple values, such as <code>"status"</code>, others are associated with more complex data. For example, the key <code>"response"</code> is associated with an object that has two keys: <code>"docs"</code>, and <code>"meta"</code>. <code>"meta"</code> is another object: <code>{  "hits":128, "offset":0, "time":19 }</code>. We can retrieve these <em>nested</em> attributes by sequentially accessing the object keys from the outside in. For example, the inner <code>"hits"</code> attribute would be accessed as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>response_js<span class="sc">$</span>response<span class="sc">$</span>meta<span class="sc">$</span>hits</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;response_js&#39; not found</code></pre>
</div>
</div>
<div class="cell">
<pre class="exercise cell-code"><code>Retrieve the data associated with 

1) the `copyright` key of the `response_js` object, and 
2) the `time` attribute nested within the `meta` object.
</code></pre>
</div>
<p>The majority of the data is stored under <code>response</code>, in <code>docs</code>. Notice that <code>docs</code> is a list, where each element of the list is a JSON object that looks like the following:</p>
<pre><code> {  
  &quot;web_url&quot;:&quot;https://www.nytimes.com/2017/06/27/arts/milkshake-duck-meme.html&quot;,
  &quot;snippet&quot;:&quot;Oxford Dictionaries is keeping a close eye on a term that describes someone who rapidly gains and inevitably loses the internet’s intense love.&quot;,  
  &quot;blog&quot;:{  },  
  &quot;source&quot;:&quot;The New York Times&quot;,  
  &quot;multimedia&quot;:[    
      ... A LIST OF OBJECTS ...  
  ],  
  &quot;headline&quot;:{    
     &quot;main&quot;:&quot;How a Joke Becomes a Meme: The Birth of ‘Milkshake Duck’&quot;,  
     &quot;print_headline&quot;:&quot;How a Joke Becomes a Meme: The Birth of ‘Milkshake Duck’&quot;  
  },  
  &quot;keywords&quot;:[    
      ... A LIST OF OBJECTS ...  
  ],  
  &quot;pub_date&quot;:&quot;2017-06-27T12:24:20+0000&quot;,  
  &quot;document_type&quot;:&quot;article&quot;,  
  &quot;new_desk&quot;:&quot;Culture&quot;,  
  &quot;byline&quot;:{    
     &quot;original&quot;:&quot;By JONAH ENGEL BROMWICH&quot;  
  },  
  &quot;type_of_material&quot;:&quot;News&quot;,  
  &quot;_id&quot;:&quot;59524e7f7c459f257c1ac39f&quot;,  
  &quot;word_count&quot;:1033,  
  &quot;score&quot;:0.35532707,  
  &quot;uri&quot;:&quot;nyt://article/a3e5bf4a-6216-5dba-9983-73bc45a98e69&quot;  
},</code></pre>
<p><code>jsonlite</code> makes lists of objects available as a data frame, where the columns are the keys in the object (<code>web_url</code>, <code>snippet</code>, etc.)</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>docs_df <span class="ot">&lt;-</span> response_js<span class="sc">$</span>response<span class="sc">$</span>docs</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;response_js&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(docs_df)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs_df&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(docs_df)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs_df&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(docs_df)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs_df&#39; not found</code></pre>
</div>
</div>
<div class="cell" name="Your own article search">
<pre class="exercise cell-code"><code>Consider the following:

 a) Select your own article search query (any topic of interest to you). You may want to play with NY Times online search or the [API web search console](https://developer.nytimes.com/docs/articlesearch-product/1/routes/articlesearch.json/get) to find a query that is interesting, but not overly popular. You can change any part of the query you would like. Your query should have at least 30 matches.
 b) Retrieve data for the first three pages of search results from the article search API, and create a data frame that joins together the `docs` data frames for the three pages of results.  Hint: The example in the section below shows how to get different pages of results and use `bind_rows to combine them.   
 c) Visualize the number of search results per day or month in your result set.
 </code></pre>
</div>
<section id="a-note-on-nested-data-frames" class="level3 unnumbered">
<h3 class="unnumbered">A Note on Nested Data Frames</h3>
<p>Here is some code to generate queries on NY Times articles about the Red Sox. It fetches the first thirty entries in batches of 10.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://api.nytimes.com/svc/search/v2/articlesearch.json&quot;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;q&quot;</span>, <span class="fu">url_encode</span>(<span class="st">&quot;Red Sox&quot;</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;api-key&quot;</span>, <span class="fu">url_encode</span>(times_key))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;times_key&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;page&quot;</span>, <span class="dv">0</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in open.connection(con, &quot;rb&quot;): cannot open URL
&#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Red%20Sox&amp;page=0&#39;:
HTTP status was &#39;401 Unauthorized&#39;</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in open.connection(con, &quot;rb&quot;): cannot open the connection to &#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Red%20Sox&amp;page=0&#39;</code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This pauses for 1 second.</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It is required when knitting to prevent R from issuing too many requests to</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The NY Times API at a time. If you don&#39;t have it you will get an error that</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># says &quot;Too Many Requests (429)&quot;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;page&quot;</span>, <span class="dv">1</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in open.connection(con, &quot;rb&quot;): cannot open URL
&#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Red%20Sox&amp;page=1&#39;:
HTTP status was &#39;401 Unauthorized&#39;</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in open.connection(con, &quot;rb&quot;): cannot open the connection to &#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Red%20Sox&amp;page=1&#39;</code></pre>
</div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">param_set</span>(url, <span class="st">&quot;page&quot;</span>, <span class="dv">2</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>res3 <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in open.connection(con, &quot;rb&quot;): cannot open URL
&#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Red%20Sox&amp;page=2&#39;:
HTTP status was &#39;401 Unauthorized&#39;</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in open.connection(con, &quot;rb&quot;): cannot open the connection to &#39;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Red%20Sox&amp;page=2&#39;</code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>docs1 <span class="ot">&lt;-</span> res1<span class="sc">$</span>response<span class="sc">$</span>docs</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res1&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>docs2 <span class="ot">&lt;-</span> res2<span class="sc">$</span>response<span class="sc">$</span>docs</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res2&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>docs3 <span class="ot">&lt;-</span> res3<span class="sc">$</span>response<span class="sc">$</span>docs</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;res3&#39; not found</code></pre>
</div>
</div>
<p>Each of these docs variables is a table with ten entries (articles) and the same 18 variables:</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(docs1)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1&#39; not found</code></pre>
</div>
</div>
<p>Now we want to stack the tables on top of each other to get a single table with 30 rows and 18 variables. If you try the following command:</p>
<pre><code>bind_rows(docs1,docs2,docs3)</code></pre>
<p>then you will get an error saying “Error in bind_rows_(x, .id) : Argument 4 can’t be a list containing data frames.”</p>
<p>What is happening???</p>
<p>Let’s check out the first column of the <code>docs1</code> table:</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>docs1<span class="sc">$</span>web_url</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1&#39; not found</code></pre>
</div>
</div>
<p>It lists the web addresses of the first ten sites returned in the search. It is a vector of ten character strings, which is just fine for one column of data in our table.</p>
<p>Now let’s check out the <code>headline</code> variable:</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>docs1<span class="sc">$</span>headline</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1&#39; not found</code></pre>
</div>
</div>
<p>The <code>headline</code> variable is actually a data frame that contains three variables: <code>main</code>, <code>kicker</code>, and <code>print_headline</code>. That is, we have <strong>nested data frames</strong>. This is a common problem when scraping data from JSON files, and it is why we are not able to directly bind the rows of our three tables on top of each other.</p>
<p>We can check out the type of variable in each column with the <code>class</code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(docs1, class)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1&#39; not found</code></pre>
</div>
</div>
<p>We see that <code>blog</code>, <code>headline</code>, and <code>byline</code> are the three problem columns that each contain their own data frames.</p>
<p>The solution is to <strong>flatten</strong> these variables, which generates a new column in the outer table for each of the columns in the inner tables.</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>docs1_flat <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">flatten</span>(docs1)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(docs1_flat)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1_flat&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(docs1_flat, class)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1_flat&#39; not found</code></pre>
</div>
</div>
<p>The <code>headline</code> variable is now replaced with seven separate columns for <code>headline.main</code>, <code>headline.kicker</code>, <code>headline.content_kicker</code>, <code>headline.print_headline</code>, <code>headline.name</code>, <code>headline.seo</code>, and <code>headline.sub</code>. The <code>byline</code> variable is replaced with three separae columns. The <code>blog</code> variable contained an empty data frame, so it has been removed. The overall result is a new flat table with 25 columns, and no more nested data frames.</p>
<p>Once the data is flattened, we can bind rows:</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>all_docs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(jsonlite<span class="sc">::</span><span class="fu">flatten</span>(docs1), jsonlite<span class="sc">::</span><span class="fu">flatten</span>(docs2), jsonlite<span class="sc">::</span><span class="fu">flatten</span>(docs3))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;docs1&#39; not found</code></pre>
</div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(all_docs)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object &#39;all_docs&#39; not found</code></pre>
</div>
</div>
</section>
</section>
<section id="additional-practice" class="level2 unnumbered">
<h2 class="unnumbered">Additional Practice</h2>
<div class="cell" name="Choose-your-own public API visualization">
<pre class="exercise cell-code"><code> Browse [toddomotos&#39; list of Public APIS](https://github.com/toddmotto/public-apis#science) and [abhishekbanthia&#39;s list of Public APIs](https://github.com/abhishekbanthia/Public-APIs). Select one of the APIs from the list. Here are a few criteria you should consider:

 * You must use the JSON approach we illustrated above; not all APIs support JSON.^[If you want to use an API that does not support JSON, you can check if there is an `R` wrapper package.]
 * Stay away from APIs that require OAuth for Authorization unless you are prepared for extra work before you get data! Most of the large social APIs (Facebook, LinkedIn, Twitter, etc.) require OAuth. toddomoto&#39;s page lists this explicitly, but you&#39;ll need to dig a bit if the API is only on abhishekbanthia&#39;s list.
 * You will probably need to explore several different APIs before you find one that works well for your interests and this assignment.
 * Beware of the `rate limits` associated with the API you choose. These determine the maximimum number of API calls you can make per second, hour or day. Though these are not always officially published, you can find them by Google (for example) `GitHub API rate limit`. If you need to slow your program down to meet the API insert calls to `Sys.sleep(1)` as is done in the example below.
 * Sketch out one interesting visualization that relies on the public API you selected earlier. Make sure the exact data you need is available. If it&#39;s not, try a new visualization or API.
 * If a wrapper package is available, you may use it, but you should also try to create the request URL and retrieve the JSON data using the techniques we showed earlier, without the wrapper package.
 * Visualize the data you collected and describe the results.
</code></pre>
</div>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">COMP/STAT 112: Introduction to Data Science</span> <span class="hidden" data-render-id="quarto-int-navbar-title">COMP/STAT 112: Introduction to Data Science</span> <span class="hidden" data-render-id="quarto-int-next">SQL</span> <span class="hidden" data-render-id="quarto-int-prev">(PART) Additional Topics</span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.htmlWelcome">Welcome</span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-1">Foundation</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/01-RStudio_Intro.html&lt;span-class=&#39;chapter-number&#39;&gt;1&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Intro-to-R,-RStudio,-and-R-Markdown&lt;/span&gt;"><span class="chapter-number">1</span>  <span class="chapter-title">Intro to R, RStudio, and R Markdown</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-2">Visualization</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/02-Intro_Data_Viz.html(PART)-Visualization">(PART) Visualization</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/03-Effective_Viz.html&lt;span-class=&#39;chapter-number&#39;&gt;2&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Effective-Visualizations&lt;/span&gt;"><span class="chapter-number">2</span>  <span class="chapter-title">Effective Visualizations</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/04-Bivariate_Viz.html&lt;span-class=&#39;chapter-number&#39;&gt;3&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;options(htmltools.dir.version-=-FALSE)&lt;/span&gt;"><span class="chapter-number">3</span>  <span class="chapter-title">options(htmltools.dir.version = FALSE)</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/05-Multivariate_Viz.html&lt;span-class=&#39;chapter-number&#39;&gt;4&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Multivariate-Visualizations&lt;/span&gt;"><span class="chapter-number">4</span>  <span class="chapter-title">Multivariate Visualizations</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/06-Spatial_Viz.html&lt;span-class=&#39;chapter-number&#39;&gt;5&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Spatial-Visualization&lt;/span&gt;"><span class="chapter-number">5</span>  <span class="chapter-title">Spatial Visualization</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-3">Data Wrangling</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/07-Six_Main_Verbs.html(PART)-Data-Wrangling">(PART) Data Wrangling</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/08-Reshaping_Data.html&lt;span-class=&#39;chapter-number&#39;&gt;6&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Reshaping-Data&lt;/span&gt;"><span class="chapter-number">6</span>  <span class="chapter-title">Reshaping Data</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/09-Join.html&lt;span-class=&#39;chapter-number&#39;&gt;7&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Joining-Two-Data-Frames&lt;/span&gt;"><span class="chapter-number">7</span>  <span class="chapter-title">Joining Two Data Frames</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/10-Factors.html&lt;span-class=&#39;chapter-number&#39;&gt;8&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Categorical-Variables-as-Factors&lt;/span&gt;"><span class="chapter-number">8</span>  <span class="chapter-title">Categorical Variables as Factors</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/11-Mini_Project.html&lt;span-class=&#39;chapter-number&#39;&gt;9&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Mini-Project&lt;/span&gt;"><span class="chapter-number">9</span>  <span class="chapter-title">Mini-Project</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-4">Data Acquisition &amp; Cleaning</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/12-Data_Import.html(PART)-Data-Acquisition-&amp;-Cleaning">(PART) Data Acquisition &amp; Cleaning</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/13-EDA.html&lt;span-class=&#39;chapter-number&#39;&gt;10&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Exploratory-Data-Analysis&lt;/span&gt;"><span class="chapter-number">10</span>  <span class="chapter-title">Exploratory Data Analysis</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/14-Regex.html&lt;span-class=&#39;chapter-number&#39;&gt;11&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Regular-Expressions&lt;/span&gt;"><span class="chapter-number">11</span>  <span class="chapter-title">Regular Expressions</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-5">Additional Topics</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/15-Data_Scraping.html(PART)-Additional-Topics">(PART) Additional Topics</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/16-API.html&lt;span-class=&#39;chapter-number&#39;&gt;12&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Public-Web-APIs&lt;/span&gt;"><span class="chapter-number">12</span>  <span class="chapter-title">Public Web APIs</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/17-SQL.htmlSQL">SQL</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/19-Adv_Viz.htmlAdvanced-Visualization">Advanced Visualization</span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/20-Shiny.html&lt;span-class=&#39;chapter-number&#39;&gt;13&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;library(flair)&lt;/span&gt;"><span class="chapter-number">13</span>  <span class="chapter-title">library(flair)</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/src/21-Prez_Tools.htmlPresentation-Tools">Presentation Tools</span> <span class="hidden" data-render-id="quarto-breadcrumbs-Additional-Topics">Additional Topics</span> <span class="hidden" data-render-id="quarto-breadcrumbs-&lt;span-class=&#39;chapter-number&#39;&gt;12&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Public-Web-APIs&lt;/span&gt;"><span class="chapter-number">12</span>  <span class="chapter-title">Public Web APIs</span></span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">COMP/STAT 112: Introduction to Data Science - <span class="chapter-number">12</span>  <span class="chapter-title">Public Web APIs</span></span> <span class="hidden" data-render-id="quarto-twittercardtitle">COMP/STAT 112: Introduction to Data Science - <span class="chapter-number">12</span>  <span class="chapter-title">Public Web APIs</span></span> <span class="hidden" data-render-id="quarto-ogcardtitle">COMP/STAT 112: Introduction to Data Science - <span class="chapter-number">12</span>  <span class="chapter-title">Public Web APIs</span></span> <span class="hidden" data-render-id="quarto-metasitename">COMP/STAT 112: Introduction to Data Science</span> <span class="hidden" data-render-id="quarto-twittercarddesc"></span> <span class="hidden" data-render-id="quarto-ogcardddesc"></span></p>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Although we imply that a Web API call corresponds to a single function on the webserver, this is not necessarily the case. Still, we use this language because the analogy fits well.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a  href="/src/15-Data_Scraping.html" class="pagination-link" aria-label="(PART) Additional Topics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">(PART) Additional Topics</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a  href="/src/17-SQL.html" class="pagination-link" aria-label="SQL">
        <span class="nav-page-text">SQL</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->

</body>

</html>
