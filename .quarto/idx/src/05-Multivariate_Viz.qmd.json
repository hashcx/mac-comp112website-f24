{"title":"Multivariate Visualizations","markdown":{"headingText":"Multivariate Visualizations","containsRefs":false,"markdown":"```{r 05_setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, error = TRUE, tidy = FALSE, message = FALSE, cache.extra = packageVersion(\"tufte\"))\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(gplots)\n```\n\n\n## Learning Goals {-}\n\n- Understand how we can use additional aesthetics such as color and size to incorporate a third (or more variables) to a bivariate plot\n- Develop comfort with interpreting heat maps and star plots, which allow you to look for patterns in variation in many variables. \n\nYou can download a template .Rmd of this activity [here](template_rmd/05-Multivariate_Viz_Assign.Rmd). Put this in a new folder called `Assignment_04` in your folder for `COMP_STAT_112`. \n\n## Adding More Aesthetic Attributes {-}\n\n### Exploring SAT Scores {-}\n\nThough far from a perfect assessment of academic preparedness, SAT scores have historically been used as one measurement of a state's education system.  The `education` [data](data/sat.csv) contain various education variables for each state:\n\n```{r eval=TRUE, echo=FALSE}\neducation <- read.csv(\"data/sat.csv\")\n```\n\n```{r eval=FALSE, echo=TRUE}\neducation <- read.csv(\"https://bcheggeseth.github.io/112_spring_2023/data/sat.csv\")\n```\n\n```{r, echo=FALSE}\nknitr::kable(\n  education[1:6, ],\n  caption = \"The first few rows of the SAT data.\"\n)\n```\n\nA codebook is provided by Danny Kaplan who also made these data accessible:\n\n```{r, echo=FALSE,out.width=\"750px\",fig.cap=\"Codebook for SAT data. Source: Danny Kaplan\"}\nknitr::include_graphics(\"images/SATcodebook.png\")\n```\n\nTo examine the variability in average SAT scores from state to state, let's start with a univariate density plot:\n\n```{r, fig.width=6,fig.height=3, fig.alt = 'Density plot of average SAT scores across U.S. states in mid-1990s. There are two groups of states, those with about 900 and those around 1050.'}\nggplot(education, aes(x = sat)) +\n  geom_density(fill = \"blue\", alpha = .5) + \n  theme_classic()\n```\n\nThe first question we'd like to answer is to what degree do per pupil spending (`expend`) and teacher `salary` *explain* this variability? We can start by plotting each against `sat`, along with a best fit linear regression model:\n\n```{r, fig.width=3,fig.height=3,fig.fullwidth=TRUE,fig.show='hold', fig.alt = c('Scatter plot of average SAT scores  against teacher salary across U.S. states in mid-1990s. There is a weak negative relationship.','Scatter plot of average SAT scores  against education expenditure across U.S. states in mid-1990s. There is a weak negative relationship.')}\nggplot(education, aes(y = sat, x = salary)) +\n  geom_point() +\n  geom_smooth(se = FALSE, method = \"lm\") + \n  theme_classic()\n\nggplot(education, aes(y = sat, x = expend)) +\n  geom_point() +\n  geom_smooth(se = FALSE, method = \"lm\") + \n  theme_classic()\n```\n\n```{example}\nIs there anything that surprises you in the above plots? What are the relationship trends?\n```\n\n<details>\n\n<summary>Solution</summary>\n\nThese seem to suggest that spending more money on students or teacher salaries correlates with lower SAT scores. Say it ain't so!\n\n\n</details>\n\n\\\n\n```{example}\nMake a single scatterplot visualization that demonstrates the relationship between `sat`, `salary`, and `expend`. Summarize the trivariate relationship between `sat`, `salary`, and `expend`. \n```\n\n*Hints: 1. Try using the color or size aesthetics to incorporate the expenditure data. 2. Include some model smooths with `geom_smooth()` to help highlight the trends.*\n\n<details>\n\n<summary>Solution</summary>\n\nBelow are four different plots that one could make. There seems to be a high correlation between `expend` and `salary`, and both seem to be negatively correlated with `sat`.\n\n```{r, fig.width=8, fig.fullwidth=TRUE, fig.alt = 'Four scatterplots of average SAT scores against teacher salary by expenditure across U.S. states in mid-1990s. There seems to be a high correlation between expenditure and salary, and both seem to be negatively correlated with SAT scores.'}\n\n#plot 1\ng1 <- ggplot(education, aes(y=sat, x=salary, color=expend)) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n    \n#plot 2\ng2 <- ggplot(education, aes(y=sat, x=salary, size=expend)) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n\n#plot 3\ng3 <- ggplot(education, aes(y=sat, x=salary, color=cut(expend,2))) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n\n#plot 4\ng4 <- ggplot(education, aes(y=sat, x=salary, color=cut(expend,3))) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n\nlibrary(gridExtra)\ngrid.arrange(g1, g2, g3, g4, ncol=2)\n```\n\n</details>\n\n\\\n\n\n```{example}\nThe `fracCat` variable in the `education` data categorizes the fraction of the state's students that take the SAT into `low` (below 15%), `medium` (15-45%), and `high` (at least 45%).\n```\n\na. Make a univariate visualization of the `fracCat` variable to better understand how many states fall into each category.   \nb. Make a bivariate visualization that demonstrates the relationship between `fracCat` and `sat`. What story does your graphic tell?\nc. Make a trivariate visualization that demonstrates the relationship between `fracCat`, `sat`, and `expend`. Incorporate `fracCat` as the color of each point, and use a single call to `geom_smooth` to add three trendlines (one for each `fracCat`). What story does your graphic tell?   \nd. Putting all of this together, explain this example of **Simpsonâ€™s Paradox**. That is, why does it appear that SAT scores decrease as spending increases even though the opposite is true?   \n\n\n<details>\n\n<summary>Solution</summary>\na. \n\n```{r fig.alt = \"Barplot of the fraction of the state's students that take the SAT, categorized into low, medium, and high. Most states have either at least 45% of the students take the SAT or less than 15%; there are not many states with participation in the middle.\"}\n\nggplot(education, aes(x = fracCat)) +\n  geom_bar() + theme_classic()\n```\n\nb.\n\n```{r fig.alt=\"Boxplot of average SAT scores by state participation in the SAT, categorized as low, medium, or high. Average SAT is higher among states with lower participation as there is self selection in who takes the SAT.\"}\n\nggplot(education, aes(x = fracCat, y = sat)) +\n  geom_boxplot() + theme_classic()\n```\n\n\nc.\n\n```{r fig.alt= \"Scatterplot of expenditure and average SAT scores by student participation within the state. There is a slight positive relationship between expenditure and SAT scores once you account for the student participation.\"}\n  \nggplot(education, aes(color = fracCat, y = sat, x = expend)) +\n  geom_point() + geom_smooth(se = FALSE, method = 'lm') + theme_classic()\n```\n\nd. Among student participation tends to be lower among states with lower expenditures. Those same states tend to have higher SAT scores because of the self-selection of who participates; only those most prepared take the SAT in those states.\n\n</details>\n\n\\\n\n## Other Multivariate Visualization Techniques {-}\n\n### Heat maps {-}    \n\nNote that each variable (column) is scaled to indicate states (rows) with high values (yellow) to low values (purple/blue).  With this in mind you can scan across rows & across columns to visually assess which states & variables are related, respectively. You can also play with the color scheme. Type `?cm.colors` in the console to see various options.    \n\n```{r, fig.width=10, fig.height=20}\ned <- as.data.frame(education) # convert from tibble to data frame\n\n# convert to a matrix with State names as the row names\nrow.names(ed) <- ed$State  #added state names as the row names rather than a variable\ned <- ed %>% select(2:8) #select the 2nd through 8th columns\ned_mat <- data.matrix(ed) #convert to a matrix format\n\nheatmap.2(ed_mat,\n  Rowv = NA, Colv = NA, scale = \"column\",\n  keysize = 0.7, density.info = \"none\",\n  col = hcl.colors(256), margins = c(10, 20),\n  colsep = c(1:7), rowsep = (1:50), sepwidth = c(0.05, 0.05),\n  sepcolor = \"white\", cexRow = 2, cexCol = 2, trace = \"none\",\n  dendrogram = \"none\"\n)\n```    \n\n```{exercise}\nWhat do you notice? What insight do you gain about the variation across U.S. states?\n```\n\n\n\n**Heat map with row clusters** \n\nIt can be tough to identify interesting patterns by visually comparing across rows and columns.  Including *dendrograms* helps to identify interesting clusters.\n\n```{r, fig.width=10, fig.height=20}\nheatmap.2(ed_mat,\n  Rowv = TRUE, #this argument changed\n  Colv = NA, scale = \"column\", keysize = .7,\n  density.info = \"none\", col = hcl.colors(256),\n  margins = c(10, 20),\n  colsep = c(1:7), rowsep = (1:50), sepwidth = c(0.05, 0.05),\n  sepcolor = \"white\", cexRow = 2, cexCol = 2, trace = \"none\",\n  dendrogram = \"row\" #this argument changed\n)\n\n\n```  \n\n```{exercise}\nWhat new insight do you gain about the variation across U.S. states, now that states are grouped and ordered by similarity?\n```\n\n\n**Heat map with column clusters** \n\nWe can also construct a heat map which identifies interesting clusters of columns (variables).\n\n```{r, fig.width=10, fig.height=20}\nheatmap.2(ed_mat,\n  Colv = TRUE, #this argument changed\n  Rowv = NA, scale = \"column\", keysize = .7,\n  density.info = \"none\", col = hcl.colors(256),\n  margins = c(10, 20),\n  colsep = c(1:7), rowsep = (1:50), sepwidth = c(0.05, 0.05),\n  sepcolor = \"white\", cexRow = 2, cexCol = 2, trace = \"none\",\n  dendrogram = \"column\" #this argument changed\n)\n```   \n\n```{exercise}\nWhat new insight do you gain about the variation across U.S. states, now that variables are grouped and ordered by similarity?\n```\n\n\n### Star plots  {-}  \n\nThere's more than one way to visualize multivariate patterns. Like heat maps, these star plot visualizations indicate the relative scale of each variable for each state.  With this in mind, you can use the star maps to identify which state is the most \"unusual.\" You can also do a quick scan of the second image to try to cluster states. How does that clustering compare to the one generated in the heat map with row clusters above?    \n\n```{r, fig.width=15, fig.height=18,  fig.alt = 'Star plot of SAT data geographically arranged. Education policy / finances and SAT scores differs by geographical region in the U.S.'}\nstars(ed_mat,\n  flip.labels = FALSE,\n  locations = data.matrix(as.data.frame(state.center)), #added external data to arrange by geo location\n  key.loc = c(-70, 30), cex = 1\n)\nstars(ed_mat,\n  flip.labels = FALSE,\n  locations = data.matrix(as.data.frame(state.center)), #added external data to arrange by geo location\n  key.loc = c(-70, 30), cex = 1, \n  draw.segments = TRUE #changed argument\n)\n```   \n\n```{exercise}\nWhat new insight do you gain about the variation across U.S. states with the star plots (arranged geographically) as compared to heat plots?\n```\n    \n    \n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles/styles.css"],"toc":true,"output-file":"05-Multivariate_Viz.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","code-copy":true,"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}