{"title":"Categorical Variables as Factors","markdown":{"headingText":"Categorical Variables as Factors","containsRefs":false,"markdown":"```{r 10_setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, error = TRUE, tidy = FALSE, message = FALSE, cache.extra = packageVersion(\"tufte\"))\nlibrary(tidyverse)\nlibrary(ggplot2)\n```\n\n\n## Learning Goals {-}\n\n- Understand the difference between a variable stored as a `character` vs. a `factor`\n- Be able to convert a `character` variable to a `factor`\n- Develop comfort in manipulating the order and values of a factor with the `forcats` package to improve summaries and visualizations.\n\nCreate a new Rmd file (save it as 10-Factors.Rmd). Put this file in a folder `Assignment_06` in your `COMP_STAT_112` folder.\n\n- You are used to using template Rmd files but you are ready to create your own! \n    - Look at previous Rmd files and notice patterns. You can copy the top YAML section over and adjust.\n    - Note that if you use \\{exercise\\}, you can copy the text of the exercise and that it will automatically number your exercises! Continue to use \\{r\\} for R chunks.\n    - Make sure to add `fig.alt` for your visualizations!\n- From now on, you'll be expected to create your own Rmd files and make them look clean and organized so that preceptors and instructors can easily read the knitted file and give feedback.\n\n\n\n## Example: Grade Distribution {-}\n\n```{r,cache=TRUE,echo=FALSE}\nGrades <- read_csv(\"data/grades.csv\")\nGrades <- Grades %>%\n  select(sid, sessionID, grade) %>%\n  distinct(sid, sessionID, .keep_all = TRUE)\n```\n\n```{r,cache=TRUE,echo=TRUE,eval=FALSE}\nGrades <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/grades.csv\")\nGrades <- Grades %>%\n  select(sid, sessionID, grade) %>%\n  distinct(sid, sessionID, .keep_all = TRUE)\n```\n\nWe will continue with the grades data from the previous activity. Here is a sample to remember what it looks like:\n\n```{r, echo=FALSE}\nset.seed(101)\nknitr::kable(\n  sample_n(Grades, size = 4),\n  align = \"ccc\", caption = \"Student grades.\"\n)\n```\n\nHere is a bar chart of the grade distribution:\n\n```{r}\nggplot(Grades, aes(x = grade)) +\n  geom_bar()\n```\n\nWe can also wrangle a table that just has each grade and the number of times it appears:\n\n```{r}\nGradeDistribution <- Grades %>%\n  group_by(grade) %>%\n  summarize(count = n())\n```\n\n```{r eval=FALSE}\n# Alternatively, we can use the count() function the creates a variable called n\nGrades %>%\n  count(grade) \n```\n\n```{r, echo=FALSE}\nknitr::kable(\n  GradeDistribution,\n  caption = \"Grade distribution.\"\n)\n```\n\n\n***What could be improved about this graphic and table?***\n\nThe grades are listed alphabetically, which isn't particularly meaningful. Why are they listed that way? Because the variable `grade` is a character string type:\n\n```{r}\nclass(Grades$grade)\n```\n\nWhen dealing with categorical variables that take a finite number of values (`levels`, formally), it is often useful to store the variable as a factor, and specify a meaningful order for the levels. \n\nFor example, when the entries are stored as character strings, we cannot use the `levels` command to see the full list of values:\n\n```{r}\nlevels(Grades$grade)\n```\n\n### Converting to factor {-}\n\nLet's first convert the `grade` variable to a factor:\n\n```{r}\nGrades <- Grades %>%\n  mutate(grade = factor(grade))\n```\n\nNow we can see the levels:\n\n```{r}\nlevels(Grades$grade)\n```\n\nMoreover, the `forcats` package (part of `tidyverse`) allows us to manipulate these factors. Its commands include the following. \n\n### Changing the order of levels {-}\n   \n- `fct_relevel()`: manually reorder levels   \n- `fct_infreq()`: order levels from highest to lowest frequency   \n- `fct_reorder()`: reorder levels by values of another variable   \n- `fct_rev()`: reverse the current order   \n\n### Changing the value of levels {-} \n\n- `fct_recode()`: manually change levels   \n- `fct_lump()`: group together least common levels   \n\nMore details on these and other commands can be found on the [forcats cheat sheet](https://github.com/rstudio/cheatsheets/raw/main/factors.pdf) or in Wickham & Grolemund's [chapter on factors](https://r4ds.had.co.nz/factors.html).\n\n\\\n\n```{example, name=\"Reorder factors\"}\nLet's reorder the grades so that they are in a more meaningful order for the bar chart above. Here are three options:\n   \n```\n\n\\\n\n**Option 1**: From high grade to low grade, with \"S\" and \"AU\" at the end:\n\n```{r fig.alt='Bar plot of grad distribution. Vast majority of grades as A / A- / B+ /B  or Satisfactory (pass).'}\nGrades %>%\n  mutate(grade = fct_relevel(grade, c(\"A\", \"A-\", \"B+\", \"B\", \"B-\", \"C+\", \"C\", \"C-\", \"D+\", \"D\", \"D-\", \"NC\", \"S\", \"AU\"))) %>%\n  ggplot(aes(x = grade)) +\n  geom_bar()\n```\n\n**Option 2**: In terms of ascending frequency:\n\n```{r fig.alt='Bar plot of grad distribution. Vast majority of grades as A / A- / B+ /B  or Satisfactory (pass).'}\nggplot(GradeDistribution) +\n  geom_col(aes(x = fct_reorder(grade, count), y = count)) +\n  labs(x = \"grade\")\n```\n     \n**Option 3**: In terms of descending frequency:\n\n```{r fig.alt='Bar plot of grad distribution. Vast majority of grades as A / A- / B+ /B  or Satisfactory (pass).'}\nggplot(GradeDistribution) +\n  geom_col(aes(x = fct_reorder(grade, count, .desc = TRUE), y = count)) +\n  labs(x = \"grade\")\n```        \n         \n\n```{example, name=\"Recode factors\"}\nBecause it may not be clear what \"AU\" and \"S\" stand for, let's rename them to \"Audit\" and \"Satisfactory\".   \n```\n\n\n```{r fig.alt='Bar plot of grad distribution. Vast majority of grades as A / A- / B+ / B or Satisfactory (pass).'}\nGrades %>%\n  mutate(grade = fct_relevel(grade, c(\"A\", \"A-\", \"B+\", \"B\", \"B-\", \"C+\", \"C\", \"C-\", \"D+\", \"D\", \"D-\", \"NC\", \"S\", \"AU\"))) %>%\n  mutate(grade = fct_recode(grade, \"Satisfactory\" = \"S\", \"Audit\" = \"AU\")) %>%\n  ggplot(aes(x = grade)) +\n  geom_bar()\n```\n\n```{exercise}\nNow that you've developed your data visualization and wrangling skills, \n``` \n\na. develop a research question to address with the grades and courses data,\nb. create a high quality visualization that addresses your research question,\nc. write a brief description of the visualization and include the insight you gain about the research question.\n\n```\nCourses <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/courses.csv\")\n```\n\n## Appendix: R Functions {.unnumbered}\n\n### Changing the order of levels {.unnumbered}\n\n| Function/Operator |                 Action                 |                       Example |\n|-------------------------|:---------------------------:|------------------:|\n| `fct_relevel()`        |  manually reorder levels of a factor  |   `Grades %>% mutate(grade = fct_relevel(grade, c(\"A\", \"A-\", \"B+\", \"B\", \"B-\", \"C+\", \"C\", \"C-\", \"D+\", \"D\", \"D-\", \"NC\", \"S\", \"AU\")))` |\n| `fct_infreq()`        | order levels from highest to lowest frequency    |   `ggplot(Grades) + geom_bar(aes(x = fct_infreq(grade)))` |\n| `fct_reorder()`        | reorder levels by values of another variable |   `ggplot(GradeDistribution) + geom_col(aes(x = fct_reorder(grade, count), y = count))` |\n| `fct_rev()`        | reverse the current order |   `ggplot(Grades) + geom_bar(aes(x = fct_rev(fct_infreq(grade))))` |\n\n\n\n### Changing the value of levels {-} \n\n| Function/Operator |                 Action                 |                       Example |\n|-------------------------|:---------------------------:|------------------:|\n| `fct_recode()`        |  manually change levels    |   `Grades %>%  mutate(grade = fct_recode(grade, \"Satisfactory\" = \"S\", \"Audit\" = \"AU\")) ` |\n| `fct_lump()`        | group together least common levels      |   `Grades %>% mutate(grade = fct_lump(grade, n = 5))` |\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../sty/styles.css"],"toc":true,"output-file":"10-Factors.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","code-copy":true,"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}