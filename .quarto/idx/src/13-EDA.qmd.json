{"title":"Exploratory Data Analysis","markdown":{"headingText":"Exploratory Data Analysis","containsRefs":false,"markdown":"```{r 13_setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, error = TRUE, tidy = FALSE, message = FALSE, cache.extra = packageVersion(\"tufte\"))\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(ggmap)\nlibrary(GGally)\n```\n\n\n## Learning Goals {-}\n\n- Understand the first steps that should be taken when you encounter a new data set\n- Develop comfort in knowing how to explore data to understand it\n- Develop comfort in formulating research questions\n\n\nCreate a new Rmd file (save it as 13-EDA.Rmd). Put this file in a folder `Assignment_08` in your `COMP_STAT_112` folder.\n\n- Make sure to add alt text using fig.alt!\n\n\n## First Steps of a Data Analysis {-}\n\nWhat are the first steps to take when you start a project or get a hold of a new data set?\n\nIn a data science project, you will typically have a question or idea brought to you: How are people interacting with the new version of my software? How is weather in St. Paul changing in the last decade? What type of people are most likely to enroll in Obamacare?\n\nYou will sometimes be given a dataset when asked one of these questions, or more often, a general description of the data you *could* get if you talked to the right people or interacted with the right software systems.\n\nIn this section, we will talk about **Exploratory Data Analysis** (EDA), a name given to the process of \n\n1. \"getting to know\" a dataset, and \n2. trying to identify any meaningful insights within it. \n\n\n[Grolemund and Wickham](\"https://r4ds.had.co.nz/explore-intro.html\") visualize the place of this \"Understand\" process with a simple diagram:\n\n```{r echo=FALSE,fig.width=5,fig.cap=\"The process of EDA, as described by Grolemund and Wickham.\",fig.alt=\"The process of EDA (import to tidy then to an iterative circle of transform, visualize, model, and finally communicate), as described by Grolemund and Wickham.\"}\nknitr::include_graphics(\"http://r4ds.had.co.nz/diagrams/data-science.png\")\n```\n\nWe view the process similarly:\n\n1) **Understand** the basic data that is available to you.\n2) **Visualize and describe** the variables that seem most interesting or relevant.\n3) **Formulate** a research question.\n4) **Analyze** the data related to the research question, starting from simple analyses to more complex ones.\n5) **Interpret** your findings, **refine** your research question, and return to step 4.\n\n\n## Understand the Basic Data {-}\n\nStart by understanding the data that is available to you. If you have a codebook, you have struck gold! If not (the more common case), you'll need to do some detective work that often involves talking to people. At this stage, ask yourself:\n\n* Where does my data come from? How was it collected?^[Particularly important questions about how it was collected include WHO (whether it is a sample of a larger data set, and, if so, how the sampling was done? Randomly? All cases during a specific time frame? All data for a selected set of users?), WHEN (is this current data or historical? what events may have had an impact?), WHAT (what variables were measured? how was it measured, self-reported through a questionnaire or measured directly?), WHY (who funded the data collection? for what purposes what the data collected? to whose benefit was the data collected?) Answers to such questions strongly impact the conclusions you will be able to draw from the data.]\n* Is there a codebook? If not, how can I learn about it?\n* Are there people I can reach out to who have experience with this data?\n\nNext, you need to load the data and clean it. Once the data is loaded, ask yourself about each table:\n\n  * What is an observation? \n  * How many observations are there? \n  * What is the meaning of each variable? \n  * What is the type of each variable (date, location, string, factor, number, boolean, etc.)?\n  \nSome great methods to start with are the functions \n\n- `str()` to learn about the numbers of variables and observations as well as the classes of variables \n- `head()` to view the top of the data table (can specify the number of rows with `n=` )\n- `tail()` to view the bottom of the data table\n\nHere is an example:\n\n```{r}\ncrime <- read_csv(\"http://datasets.flowingdata.com/crimeRatesByState2005.csv\")\nstr(crime)\nhead(crime)\ntail(crime)\n```\n\nFinally, ask yourself about the relationships between tables:\n\n  * What variables are keys and link the tables (i.e., which variables can you use in `join` commands)?\n  \n\n## Visualize and Describe the Data {-}\n\nOnce you have the data loaded and cleaned, it is usually helpful to do some univariate visualization; e.g., plotting histograms, densities, and box plots of different variables. You might ask questions such as:\n\n* What do you see that is interesting? \n* Which values are most common or unusual (outliers)?\n* Is there a lot of missing data?\n* What type of variation occurs within the individual variables?\n* What might be causing the interesting findings?\n* How could you figure out whether your ideas are correct?\n\nOnce you have done some univariate visualization, you might examine the **covariation** between different variables. One convenient way to do this is with a `pairs` plot. \n\nHere are three different versions of such plots based on 2005 crime data (rates per 100,000 population) from Chapter 6 of *Visualize This*, by Nathan Yau. The main point of such plots is not necessarily to draw any conclusions, but help generate more specific research questions and hypotheses.\n\n```{r fig.width=10,fig.height=8, fig.alt='Scatter plot matrix of relationships between each quantitative variable. The crime rate of some types are positively correlated (burglary and larceny theft) between states buth others are not (murder and burglary).'}\ncrime2 <- crime %>%\n  filter(state != \"District of Columbia\", state != \"United States\")\npairs(crime2[, 2:9], panel = panel.smooth)\n```\n\n```{r fig.width=10,fig.height=8, fig.alt='Scatter plot matrix of relationships between each quantitative variable. The crime rate of some types are positively correlated (burglary and larceny theft) between states buth others are not (murder and burglary).'}\nggpairs(crime2[, 2:9], aes(alpha = 0.4)) + theme_minimal()\n```\n\n```{r fig.width=10,fig.height=8}\nlowerFn <- function(data, mapping, method = \"lm\", ...) {\n  p <- ggplot(data = data, mapping = mapping) +\n    geom_point(colour = \"blue\") +\n    geom_smooth(method = method, color = \"red\", ...)\n  p\n}\n\nggpairs(\n  crime2[, 2:9],\n  lower = list(continuous = wrap(lowerFn, method = \"lm\")),\n  diag = list(continuous = wrap(\"barDiag\", colour = \"blue\")),\n  upper = list(continuous = wrap(\"cor\", size = 5))\n)\n```\n\n\n## Formulate a Research Question {-}\n\nYou will often end up with a lot of data, and it can be easy to be overwhelmed. How should you get started? One easy idea is to brainstorm ideas for research questions, and pick one that seems promising. This process is much easier with more than one brain! You will often be working off of a broad question posed by your business, organization, or supervisor, and be thinking about how to narrow it down. To do so, you can again revisit questions like \"What patterns do you see?\" or \"Why might they be occurring?\"\n\n## Examples  {-}\n\nHere are some exploratory data analysis examples I like:\n\n\n- [Crime mapping](https://www.kaggle.com/mircat/violent-crime-mapping)\n\n- [Changes in fine particle air pollution in the US](https://bookdown.org/rdpeng/exdata/data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html)\n\n- [Married people have more sex](http://flowingdata.com/2017/07/03/married-people-sex/)^[The graphics in this one are a bit more developed than you would really see in an exploratory analysis, but I think the progression of visualizations is interesting and follows an exploratory story.]\n\n- [Tropical storm analysis](https://www.r-bloggers.com/2017/09/exploratory-data-analysis-of-tropical-storms-in-r/)\n\n## Practice: Flight Data {-}\n\nLet's practice these steps using data about [flight delays from Kaggle](https://www.kaggle.com/usdot/flight-delays). You have access to the data for [airlines](data/airlines.csv), [airports](data/airports.csv), and [flights](data/flights_jan_jul_sample2.csv).\n\nThere are three tables of data:\n\n```{r, cache=TRUE, echo=FALSE}\nairlines <- read_csv(\"data/airlines.csv\")\nairports <- read_csv(\"data/airports.csv\")\nflights <- read_csv(\"data/flights_jan_jul_sample2.csv\")\n```\n\n```{r, cache=TRUE,eval=FALSE}\nairlines <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/airlines.csv\")\nairports <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/airports.csv\")\nflights <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/flights_jan_jul_sample2.csv\")\n```\n\nNote that the full set of flight data has more than 5.8 million flights. To start, I have given you a subset that includes all flights in the first 15 days of January 2015 and in the first 15 days of July 2015. If at the end you wish to try your analysis on the whole data set, you can download the original .csv file from the Kaggle page and substitute a link to it in the code chunk above.\n\n\nThere is a ton of data here, and it can be easy to be overwhelmed. We are going to focus our exploration a bit by considering the following broad research question: **which flights are most likely to be delayed?**\n\n```{exercise, name=\"Data source\"}\nWhere does this data come from? Who collected it?   \n```\n\n\n```{exercise, name=\"Explore codebook\"}\nThis data set comes with a codebook on the Kaggle site. Have a look at the codebook to understand which variables are contained in each of the three tables. \n\nWhat is the unit of observation for each table?\nWhat are the levels of `CANCELLATION_REASON` and what do they mean? \n  \n```\n\n```{exercise, name=\"Possible joins\"}\nWhat variables link the three tables? How could you join data from one table to another?\n  \n```\n\n\n```{exercise, name=\"Visualize and describe the data\"}\nUse some univariate and bivariate visualizations to start to explore the questions mentioned above:\n\n* What do you see that is interesting? \n* Which values are most common or unusual (outliers)?\n* Is there a lot of missing data?\n* What type of variation occurs within the individual variables?\n* What might be causing the interesting findings?\n* How could you figure out whether your ideas are correct?\n\n```\n\n```{exercise, name=\"Formulate a specific research question\"}\nBased on your preliminary visualizations and exploration of the date, formulate a more specific research question/hypothesis within this broad area of understanding the causes of flight delays.\n\n```\n\n```{exercise, name=\"Share a visualization\"}\nDevelop a single visualization to share with the class that tells a story about your more specific research question/hypothesis. Note: the story may very well be something along the lines of \"we thought variable X would affect flight delays in way Y, but the evidence does not support that.\"\n\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles/styles.css"],"toc":true,"output-file":"13-EDA.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","code-copy":true,"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}