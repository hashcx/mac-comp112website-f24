{
  "hash": "f0e7e97dbe3bd28cb02e53105c469f90",
  "result": {
    "engine": "knitr",
    "markdown": "\n\n\n# Multivariate Visualizations\n\n## Learning Goals {-}\n\n- Understand how we can use additional aesthetics such as color and size to incorporate a third (or more variables) to a bivariate plot\n- Develop comfort with interpreting heat maps and star plots, which allow you to look for patterns in variation in many variables. \n\nYou can download a template .Rmd of this activity [here](template_rmd/05-Multivariate_Viz_Assign.Rmd). Put this in a new folder called `Assignment_04` in your folder for `COMP_STAT_112`. \n\n## Adding More Aesthetic Attributes {-}\n\n### Exploring SAT Scores {-}\n\nThough far from a perfect assessment of academic preparedness, SAT scores have historically been used as one measurement of a state's education system.  The `education` [data](data/sat.csv) contain various education variables for each state:\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neducation <- read.csv(\"https://bcheggeseth.github.io/112_spring_2023/data/sat.csv\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n:::\n\n\nA codebook is provided by Danny Kaplan who also made these data accessible:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n\n```\nError in knitr::include_graphics(\"images/SATcodebook.png\"): Cannot find the file(s): \"images/SATcodebook.png\"\n```\n\n\n:::\n:::\n\n\nTo examine the variability in average SAT scores from state to state, let's start with a univariate density plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(education, aes(x = sat)) +\n  geom_density(fill = \"blue\", alpha = .5) + \n  theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n:::\n\n\nThe first question we'd like to answer is to what degree do per pupil spending (`expend`) and teacher `salary` *explain* this variability? We can start by plotting each against `sat`, along with a best fit linear regression model:\n\n\n::: {.cell fig.fullwidth='true'}\n\n```{.r .cell-code}\nggplot(education, aes(y = sat, x = salary)) +\n  geom_point() +\n  geom_smooth(se = FALSE, method = \"lm\") + \n  theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(education, aes(y = sat, x = expend)) +\n  geom_point() +\n  geom_smooth(se = FALSE, method = \"lm\") + \n  theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.example .cell-code}\nIs there anything that surprises you in the above plots? What are the relationship trends?\n```\n:::\n\n\n<details>\n\n<summary>Solution</summary>\n\nThese seem to suggest that spending more money on students or teacher salaries correlates with lower SAT scores. Say it ain't so!\n\n\n</details>\n\n\\\n\n\n::: {.cell}\n\n```{.example .cell-code}\nMake a single scatterplot visualization that demonstrates the relationship between `sat`, `salary`, and `expend`. Summarize the trivariate relationship between `sat`, `salary`, and `expend`. \n```\n:::\n\n\n*Hints: 1. Try using the color or size aesthetics to incorporate the expenditure data. 2. Include some model smooths with `geom_smooth()` to help highlight the trends.*\n\n<details>\n\n<summary>Solution</summary>\n\nBelow are four different plots that one could make. There seems to be a high correlation between `expend` and `salary`, and both seem to be negatively correlated with `sat`.\n\n\n::: {.cell fig.fullwidth='true'}\n\n```{.r .cell-code}\n#plot 1\ng1 <- ggplot(education, aes(y=sat, x=salary, color=expend)) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n\n```{.r .cell-code}\n#plot 2\ng2 <- ggplot(education, aes(y=sat, x=salary, size=expend)) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n\n```{.r .cell-code}\n#plot 3\ng3 <- ggplot(education, aes(y=sat, x=salary, color=cut(expend,2))) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n\n```{.r .cell-code}\n#plot 4\ng4 <- ggplot(education, aes(y=sat, x=salary, color=cut(expend,3))) + \n    geom_point() + \n    geom_smooth(se=FALSE, method=\"lm\") + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(gridExtra)\ngrid.arrange(g1, g2, g3, g4, ncol=2)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'g1' not found\n```\n\n\n:::\n:::\n\n\n</details>\n\n\\\n\n\n\n::: {.cell}\n\n```{.example .cell-code}\nThe `fracCat` variable in the `education` data categorizes the fraction of the state's students that take the SAT into `low` (below 15%), `medium` (15-45%), and `high` (at least 45%).\n```\n:::\n\n\na. Make a univariate visualization of the `fracCat` variable to better understand how many states fall into each category.   \nb. Make a bivariate visualization that demonstrates the relationship between `fracCat` and `sat`. What story does your graphic tell?\nc. Make a trivariate visualization that demonstrates the relationship between `fracCat`, `sat`, and `expend`. Incorporate `fracCat` as the color of each point, and use a single call to `geom_smooth` to add three trendlines (one for each `fracCat`). What story does your graphic tell?   \nd. Putting all of this together, explain this example of **Simpsonâ€™s Paradox**. That is, why does it appear that SAT scores decrease as spending increases even though the opposite is true?   \n\n\n<details>\n\n<summary>Solution</summary>\na. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(education, aes(x = fracCat)) +\n  geom_bar() + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n:::\n\n\nb.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(education, aes(x = fracCat, y = sat)) +\n  geom_boxplot() + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n:::\n\n\n\nc.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(education, aes(color = fracCat, y = sat, x = expend)) +\n  geom_point() + geom_smooth(se = FALSE, method = 'lm') + theme_classic()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n:::\n\n\nd. Among student participation tends to be lower among states with lower expenditures. Those same states tend to have higher SAT scores because of the self-selection of who participates; only those most prepared take the SAT in those states.\n\n</details>\n\n\\\n\n## Other Multivariate Visualization Techniques {-}\n\n### Heat maps {-}    \n\nNote that each variable (column) is scaled to indicate states (rows) with high values (yellow) to low values (purple/blue).  With this in mind you can scan across rows & across columns to visually assess which states & variables are related, respectively. You can also play with the color scheme. Type `?cm.colors` in the console to see various options.    \n\n\n::: {.cell}\n\n```{.r .cell-code}\ned <- as.data.frame(education) # convert from tibble to data frame\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'education' not found\n```\n\n\n:::\n\n```{.r .cell-code}\n# convert to a matrix with State names as the row names\nrow.names(ed) <- ed$State  #added state names as the row names rather than a variable\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed' not found\n```\n\n\n:::\n\n```{.r .cell-code}\ned <- ed %>% select(2:8) #select the 2nd through 8th columns\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed' not found\n```\n\n\n:::\n\n```{.r .cell-code}\ned_mat <- data.matrix(ed) #convert to a matrix format\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed' not found\n```\n\n\n:::\n\n```{.r .cell-code}\nheatmap.2(ed_mat,\n  Rowv = NA, Colv = NA, scale = \"column\",\n  keysize = 0.7, density.info = \"none\",\n  col = hcl.colors(256), margins = c(10, 20),\n  colsep = c(1:7), rowsep = (1:50), sepwidth = c(0.05, 0.05),\n  sepcolor = \"white\", cexRow = 2, cexCol = 2, trace = \"none\",\n  dendrogram = \"none\"\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed_mat' not found\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.exercise .cell-code}\nWhat do you notice? What insight do you gain about the variation across U.S. states?\n```\n:::\n\n\n\n\n**Heat map with row clusters** \n\nIt can be tough to identify interesting patterns by visually comparing across rows and columns.  Including *dendrograms* helps to identify interesting clusters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheatmap.2(ed_mat,\n  Rowv = TRUE, #this argument changed\n  Colv = NA, scale = \"column\", keysize = .7,\n  density.info = \"none\", col = hcl.colors(256),\n  margins = c(10, 20),\n  colsep = c(1:7), rowsep = (1:50), sepwidth = c(0.05, 0.05),\n  sepcolor = \"white\", cexRow = 2, cexCol = 2, trace = \"none\",\n  dendrogram = \"row\" #this argument changed\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed_mat' not found\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.exercise .cell-code}\nWhat new insight do you gain about the variation across U.S. states, now that states are grouped and ordered by similarity?\n```\n:::\n\n\n\n**Heat map with column clusters** \n\nWe can also construct a heat map which identifies interesting clusters of columns (variables).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheatmap.2(ed_mat,\n  Colv = TRUE, #this argument changed\n  Rowv = NA, scale = \"column\", keysize = .7,\n  density.info = \"none\", col = hcl.colors(256),\n  margins = c(10, 20),\n  colsep = c(1:7), rowsep = (1:50), sepwidth = c(0.05, 0.05),\n  sepcolor = \"white\", cexRow = 2, cexCol = 2, trace = \"none\",\n  dendrogram = \"column\" #this argument changed\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed_mat' not found\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.exercise .cell-code}\nWhat new insight do you gain about the variation across U.S. states, now that variables are grouped and ordered by similarity?\n```\n:::\n\n\n\n### Star plots  {-}  \n\nThere's more than one way to visualize multivariate patterns. Like heat maps, these star plot visualizations indicate the relative scale of each variable for each state.  With this in mind, you can use the star maps to identify which state is the most \"unusual.\" You can also do a quick scan of the second image to try to cluster states. How does that clustering compare to the one generated in the heat map with row clusters above?    \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstars(ed_mat,\n  flip.labels = FALSE,\n  locations = data.matrix(as.data.frame(state.center)), #added external data to arrange by geo location\n  key.loc = c(-70, 30), cex = 1\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed_mat' not found\n```\n\n\n:::\n\n```{.r .cell-code}\nstars(ed_mat,\n  flip.labels = FALSE,\n  locations = data.matrix(as.data.frame(state.center)), #added external data to arrange by geo location\n  key.loc = c(-70, 30), cex = 1, \n  draw.segments = TRUE #changed argument\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'ed_mat' not found\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.exercise .cell-code}\nWhat new insight do you gain about the variation across U.S. states with the star plots (arranged geographically) as compared to heat plots?\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}