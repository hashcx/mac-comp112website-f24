{
  "hash": "4d7d6606f052ad23fa3c971f0f83814a",
  "result": {
    "engine": "knitr",
    "markdown": "\n\n\n\n# Reshaping Data\n\n## Learning Goals {-}\n\n- Understand the difference between wide and long data format and distinguish the case (unit of observation) for a given data set\n- Develop comfort in using `pivot_wider` and `pivot_longer` in the `tidyr` package\n\nYou can download a template .Rmd of this activity [here](template_rmd/08-Reshaping_Data_Assign.Rmd). Put the file in the existing folder `Assignment_06` in your `COMP_STAT_112` folder.\n\n\n## Wide and Long Data Formats {-}\n\nAdditional reading: \n\n* [Wickham and Grolemund on pivoting](https://r4ds.had.co.nz/tidy-data.html#pivoting), or \n* [Baumer, Kaplan, and Horton on reshaping data](https://mdsr-book.github.io/mdsr2e/ch-dataII.html#reshaping-data)\n\nAs we are transforming data, it is important to keep in mind what constitutes each case (row) of the data. For example, in the initial `babynames` data below, each case is a single name-sex-year combination. So if we have the same name and sex assigned at birth but a different year, that would be a different case.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Each case is one name-sex-year combination.\n\n| year|sex |name      |    n|      prop|\n|----:|:---|:---------|----:|---------:|\n| 1880|F   |Mary      | 7065| 0.0723836|\n| 1880|F   |Anna      | 2604| 0.0266790|\n| 1880|F   |Emma      | 2003| 0.0205215|\n| 1880|F   |Elizabeth | 1939| 0.0198658|\n| 1880|F   |Minnie    | 1746| 0.0178884|\n| 1880|F   |Margaret  | 1578| 0.0161672|\n\n\n:::\n:::\n\n\n\nIt is often necessary to rearrange your data in order to create visualizations, run statistical analysis, etc. We have already seen some ways to rearrange the data to change the unit of observation (also known as the case). For example, what is the case after performing the following command?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbabynamesTotal <- babynames %>%\n  group_by(name, sex) %>%\n  summarise(total = sum(n))\n```\n:::\n\n\n\nEach case now represents one name-sex combination:\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Long format where each case is one name-sex combination.\n\n|name      |sex | total|\n|:---------|:---|-----:|\n|Aaban     |M   |   107|\n|Aabha     |F   |    35|\n|Aabid     |M   |    10|\n|Aabir     |M   |     5|\n|Aabriella |F   |    32|\n|Aada      |F   |     5|\n\n\n:::\n:::\n\n\n\nIn this activity, we are going to learn two new operations to reshape and reorganize the data: `pivot_wider()` and `pivot_longer()`.\n\n### Wider {-}\n\n\n\n::: {.cell}\n\n```{.example .cell-code}\nWe want to find the common names that are the most gender neutral (used roughly equally for males and females). How should we rearrange the data? \n```\n:::\n\n\n\nWell, one nice way would be to have a single row for each name, and then have separate variables for the number of times that name is used for males and females. Using these two columns, we can then compute a third column that gives the ratio between these two columns. That is, we'd like to transform the data into a **wide format** with each of the possible values of the `sex` variable becoming its own column. The operation we need to perform this transformation is **`pivot_wider()`**. \n\nThe inputs for this function are:\n\n- `names_from` (the original variable `sex` in this case) that identifies the variable in the initial long format data whose values should become the names of the new variables in the wide format data. \n- `names_sort = TRUE` dictates that the variables are listed in alphabetical order; when it is FALSE, they are listed in order of first appearance.\n-  `values_from`  (`total` in this case) representing the variable to be divided into multiple new variables, \n- `values_fill = 0` specifies that if there are, e.g., no females named Aadam, we should include a zero in the corresponding entry of the wide format table\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Illustration of pivot_wider from tidyr cheatsheet.](../images/pivot_wider.png){fig-alt='Illustration of pivot_wider in which values in a column get spread out over multiple columns (from tidyr cheatsheet).' width=5.39in}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nBabyWide <- babynamesTotal %>%\n  pivot_wider(names_from = sex, values_from = total, values_fill = 0, names_sort = TRUE)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: A wide format with one case per name enables us to examine gender balance.\n\n|name      |  F|   M|\n|:---------|--:|---:|\n|Aaban     |  0| 107|\n|Aabha     | 35|   0|\n|Aabid     |  0|  10|\n|Aabir     |  0|   5|\n|Aabriella | 32|   0|\n|Aada      |  5|   0|\n\n\n:::\n:::\n\n\n\nNow we can choose common names with frequency greater than 25,000 for both males and females, and sort by the ratio to identify gender-neutral names.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNeutral <- BabyWide %>%\n  filter(M > 25000, F > 25000) %>%\n  mutate(ratio = pmin(M / F, F / M)) %>% #pmin() stands for parallel min, finds the min(M/F, F/M) within each row\n  arrange(desc(ratio))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: The most gender-neutral common names, in wide format.\n\n|name    |      F|      M|     ratio|\n|:-------|------:|------:|---------:|\n|Kerry   |  48534|  49596| 0.9785870|\n|Riley   | 100881|  92789| 0.9197867|\n|Quinn   |  28283|  31230| 0.9056356|\n|Jackie  |  90604|  78405| 0.8653591|\n|Frankie |  33236|  40552| 0.8195897|\n|Jaime   |  49673|  67582| 0.7350034|\n|Casey   |  76020| 110165| 0.6900558|\n|Peyton  |  69256|  47682| 0.6884891|\n|Pat     |  40123|  26731| 0.6662264|\n|Jessie  | 167010| 110027| 0.6588049|\n|Kendall |  58026|  33821| 0.5828594|\n|Jody    |  55691|  31206| 0.5603419|\n\n\n:::\n:::\n\n\n\n### Longer {-}\n\nNext, let's filter these names to keep only those with a ratio of 0.5 or greater (no more than 2 to 1), and then switch back to long format. We can do this with the following **`pivot_longer()`** operation. It gathers the columns listed c(`F`,`M`) under the `cols` argument into a single column whose name is given by the `names_to` argument (\"sex\"), and includes the values in a column called `total`, which is the input to the `values_to` argument.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Illustration of pivot_longer from tidyr cheatsheet.](../images/pivot_longer.png){fig-alt='Illustration of pivot_longer in which values in a row get stack on top of each other in a column (from tidyr cheatsheet).' width=5.22in}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nNeutralLong <- Neutral %>%\n  filter(ratio >= .5) %>%\n  pivot_longer(cols = c(`F`, `M`), names_to = \"sex\", values_to = \"total\") %>%\n  select(name, sex, total) %>%\n  arrange(name)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Long format for the most gender-neutral common names.\n\n|name    |sex |  total|\n|:-------|:---|------:|\n|Casey   |F   |  76020|\n|Casey   |M   | 110165|\n|Frankie |F   |  33236|\n|Frankie |M   |  40552|\n|Jackie  |F   |  90604|\n|Jackie  |M   |  78405|\n|Jaime   |F   |  49673|\n|Jaime   |M   |  67582|\n|Jessie  |F   | 167010|\n|Jessie  |M   | 110027|\n|Jody    |F   |  55691|\n|Jody    |M   |  31206|\n|Kendall |F   |  58026|\n|Kendall |M   |  33821|\n|Kerry   |F   |  48534|\n|Kerry   |M   |  49596|\n|Pat     |F   |  40123|\n|Pat     |M   |  26731|\n|Peyton  |F   |  69256|\n|Peyton  |M   |  47682|\n|Quinn   |F   |  28283|\n|Quinn   |M   |  31230|\n|Riley   |F   | 100881|\n|Riley   |M   |  92789|\n\n\n:::\n:::\n\n\n\n\n## Example: The Daily Show Guests {-}\n\nThe data associated with [this article](https://fivethirtyeight.com/datalab/every-guest-jon-stewart-ever-had-on-the-daily-show/) is available in the `fivethirtyeight` package, and is loaded into `Daily` below. It includes a list of every guest to ever appear on Jon Stewart's The Daily Show. Note that when multiple people appeared together, each person receives their own line.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDaily <- daily_show_guests\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| year|google_knowledge_occupation     |show       |group    |raw_guest_list                    |\n|----:|:-------------------------------|:----------|:--------|:---------------------------------|\n| 1999|singer                          |1999-07-26 |Musician |Donny Osmond                      |\n| 1999|actress                         |1999-07-27 |Acting   |Wendie Malick                     |\n| 1999|vocalist                        |1999-07-28 |Musician |Vince Neil                        |\n| 1999|film actress                    |1999-07-29 |Acting   |Janeane Garofalo                  |\n| 1999|comedian                        |1999-08-10 |Comedy   |Dom Irrera                        |\n| 1999|actor                           |1999-08-11 |Acting   |Pierce Brosnan                    |\n| 1999|director                        |1999-08-12 |Media    |Eduardo Sanchez and Daniel Myrick |\n| 1999|film director                   |1999-08-12 |Media    |Eduardo Sanchez and Daniel Myrick |\n| 1999|american television personality |1999-08-16 |Media    |Carson Daly                       |\n| 1999|actress                         |1999-08-17 |Acting   |Molly Ringwald                    |\n| 1999|actress                         |1999-08-18 |Acting   |Sarah Jessica Parker              |\n\n\n:::\n:::\n\n\n\n### Practice: Popular guests {-}\n\n\n\n::: {.cell}\n\n```{.exercise .cell-code}\nCreate the following table containing 19 columns. The first column should have the ten guests with the highest number of total apperances on the show, listed in descending order of number of appearances. The next 17 columns should show the number of appearances of the corresponding guest in each year from 1999 to 2015 (one per column). The final column should show the total number of appearances for the corresponding guest over the entire duration of the show (these entries should be in decreasing order). Hint: the function `rowSums()` adds up all of the entries in each row of a table. Try using it in a `mutate()`.\n\n```\n:::\n\n\n\n### Practice: Recreating a graphic {-}\n\nThe original data has 18 different entries for the `group` variable:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(Daily$group)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Acting\"         \"Comedy\"         \"Musician\"       \"Media\"         \n [5] NA               \"Politician\"     \"Athletics\"      \"Business\"      \n [9] \"Advocacy\"       \"Political Aide\" \"Misc\"           \"Academic\"      \n[13] \"Government\"     \"media\"          \"Clergy\"         \"Science\"       \n[17] \"Consultant\"     \"Military\"      \n```\n\n\n:::\n:::\n\n\n\nIn order to help you recreate the first figure from [the article](https://fivethirtyeight.com/datalab/every-guest-jon-stewart-ever-had-on-the-daily-show/), I have added a new variable with three broader groups: (i) entertainment; (ii) politics, business, and government, and (iii) commentators. The data is available [here](data/daily-group-assignment.csv). We will learn in the next activity what the `inner_join` in this code chunk is doing.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDailyGroups <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/daily-group-assignment.csv\")\nDaily <- Daily %>%\n  inner_join(DailyGroups, by = c(\"group\" = \"group\"))\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| year|google_knowledge_occupation |show       |group  |raw_guest_list   |broad_group   |\n|----:|:---------------------------|:----------|:------|:----------------|:-------------|\n| 1999|actor                       |1999-01-11 |Acting |Michael J. Fox   |Entertainment |\n| 1999|comedian                    |1999-01-12 |Comedy |Sandra Bernhard  |Entertainment |\n| 1999|television actress          |1999-01-13 |Acting |Tracey Ullman    |Entertainment |\n| 1999|film actress                |1999-01-14 |Acting |Gillian Anderson |Entertainment |\n| 1999|actor                       |1999-01-18 |Acting |David Alan Grier |Entertainment |\n| 1999|actor                       |1999-01-19 |Acting |William Baldwin  |Entertainment |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.exercise .cell-code}\nUsing the group assignments contained in the `broad_group` variable, recreate the graphic from the article, with three different lines showing the fraction of guests in each group over time. Hint: first think about what your case should be for the glyph-ready form.\n\n```\n:::\n\n\n\n\n## More Practice: Pivoting Longer {-}\n\nA typical situation that requires a `pivot_longer` command is when the columns represent the possible values of a variable. Table \\@ref(tab:lesotho-table) shows example data set from [opendataforafrica.org](http://dataportal.opendataforafrica.org/) with different years in different columns. You can find the data [here](data/Lesotho.csv).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLesotho <- read_csv(\"https://bcheggeseth.github.io/112_spring_2023/data/Lesotho.csv\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n\n```\nError: 'data/Lesotho.csv' does not exist in current working directory ('C:/Users/Amin Alhashim/Documents/GitHub/hashcx/mac-comp112website-f24/src').\n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n\n```\nError in eval(expr, envir, enclos): object 'Lesotho' not found\n```\n\n\n:::\n:::\n\n::: {.cell name='Practice pivoting longer'}\n\n```{.exercise .cell-code}\nMake a side-by-side bar chart with the `year` on the horizontal axis, and three side-by-side vertical columns for average interest rate on deposits, average interest rate on loans, and inflation rate for each year. In order to get the data into glyph-ready form, you'll need to use `pivot_longer`. Hint: `pivot_longer` uses the `dplyr::select()` notation, so you can, e.g., list the columns you want to select, use colon notation, or use `starts_with(a string)`. See [Wickham and Grolemund](https://r4ds.had.co.nz/transform.html#select) for more information.\n\n```\n:::\n\n\n\n\n\n## Appendix: R Functions {.unnumbered}\n\n### Reshaping Functions {.unnumbered}\n\n| Function/Operator |                 Action                 |                       Example |\n|-------------------------|:---------------------------:|------------------:|\n| `pivot_wider()`        |   Takes a long data set and spreads information in columns into many new variables (wider)  |   `babynamesTotal %>% pivot_wider(names_from = sex, values_from = total, values_fill = 0, names_sort = TRUE)` |\n| `pivot_longer()`        | Takes a wide data set and gathers information in columns into fewer variables (longer) |   ` Neutral %>% pivot_longer(cols = c(`F`, `M`), names_to = \"sex\", values_to = \"total\")` |\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}